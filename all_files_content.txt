=== –§–∞–π–ª: ./frontend/Dockerfile ===
FROM node:20-alpine AS builder

RUN npm install -g pnpm

WORKDIR /app
COPY package*.json .
RUN pnpm install --frozen-lockfile
COPY . .
RUN pnpm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/Dockerfile ===

=== –§–∞–π–ª: ./frontend/eslint.config.js ===
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])

=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/eslint.config.js ===

=== –§–∞–π–ª: ./frontend/index.html ===
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>frontend</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/index.html ===

=== –§–∞–π–ª: ./frontend/nginx.conf ===
user nginx;
events { worker_connections 1024; }
http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    sendfile on;
    keepalive_timeout 65;

    server {
        listen 80;
        server_name _;
        root /usr/share/nginx/html;
        index index.html;

        location / {
            try_files $uri $uri/ /index.html;
        }
    }
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/nginx.conf ===

=== –§–∞–π–ª: ./frontend/package.json ===
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@types/heatmap.js": "^2.0.41",
    "axios": "^1.13.2",
    "heatmap.js": "^2.0.5",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}

=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/package.json ===

=== –§–∞–π–ª: ./frontend/public/vite.svg ===
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/public/vite.svg ===

=== –§–∞–π–ª: ./frontend/README.md ===
–ù–∏–∂–µ ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ **–∑–∞–º–µ–Ω—è—é—Ç** —Å–æ–±–æ–π —Å—Ç–∞—Ä—ã–µ.  
–õ–æ–≥–∏–∫–∞ React –Ω–µ –º–µ–Ω—è–ª–∞—Å—å, –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –∏ –º–æ–±–∏–ª—å–Ω—ã–µ ¬´—Ñ–∏–Ω—Ç–∏—Ñ–ª—é—à–∫–∏¬ª (–∞–∫–∫–æ—Ä–¥–µ–æ–Ω —Ñ–∏–ª—å—Ç—Ä–æ–≤, safe-area, –∫—Ä—É–ø–Ω—ã–µ —Ç–∞—á-—Ç–∞—Ä–≥–µ—Ç—ã, –Ω–∞—Ç–∏–≤–Ω–∞—è –º–æ–¥–∞–ª–∫–∞ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –∏ —Ç.–¥.).  
–ü—Ä–æ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏—Ö –ø–æ–≤–µ—Ä—Ö —Å—Ç–∞—Ä—ã—Ö –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç.

--------------------------------------------------
ResultsPage.module.css
--------------------------------------------------
/* ==========  CORE  ========== */
.page{padding:1rem;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,sans-serif;min-height:calc(100vh - 60px);box-sizing:border-box;background:#f8fafc}
@media(min-width:768px){.page{padding:1.5rem 2rem}}

.header{display:flex;flex-direction:column;gap:1rem;margin-bottom:1.5rem}
@media(min-width:768px){.header{flex-direction:row;justify-content:space-between;align-items:center}}

.h2{font-size:1.5rem;font-weight:700;margin:0;color:#1e293b;line-height:1.2}
@media(min-width:768px){.h2{font-size:1.75rem}}

.resultsSummary{display:flex;gap:1.5rem;background:#fff;padding:.875rem 1.25rem;border-radius:12px;border:1px solid #e2e8f0;box-shadow:0 1px 3px rgba(0,0,0,.05)}
.summaryItem{display:flex;flex-direction:column;align-items:center;gap:.25rem}
.summaryLabel{font-size:.75rem;color:#64748b;font-weight:500;text-transform:uppercase;letter-spacing:.025em}
.summaryValue{font-size:1.25rem;font-weight:700;color:#3b82f6}

.filtersContainer{background:#fff;border-radius:12px;padding:1.25rem;margin-bottom:1.5rem;border:1px solid #e2e8f0;box-shadow:0 1px 3px rgba(0,0,0,.05)}
.filtersHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.25rem;padding-bottom:.75rem;border-bottom:1px solid #f1f5f9}
.filtersTitle{font-size:1rem;font-weight:600;color:#1e293b}
.clearFilters{font-size:.875rem;color:#3b82f6;background:none;border:none;cursor:pointer;padding:.375rem .75rem;border-radius:6px;transition:all .2s}
.clearFilters:hover{background:#eff6ff}

.filterGrid{display:grid;grid-template-columns:1fr;gap:1rem}
@media(min-width:768px){.filterGrid{grid-template-columns:repeat(2,1fr)}}
@media(min-width:1024px){.filterGrid{grid-template-columns:repeat(3,1fr)}}
.filterGroup{display:flex;flex-direction:column;gap:.5rem}
.filterLabel{font-size:.875rem;font-weight:500;color:#475569}
.filterSelect{width:100%;padding:.625rem .75rem;border:1px solid #d1d5db;border-radius:8px;font-size:.875rem;background:#fff;color:#1e293b;box-sizing:border-box;transition:border-color .2s}
.filterSelect:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1)}

.rangeInputs{display:flex;align-items:center;gap:.5rem}
.rangeInput{flex:1;padding:.625rem .75rem;border:1px solid #d1d5db;border-radius:8px;font-size:.875rem;background:#fff;color:#1e293b;box-sizing:border-box;text-align:center}
.rangeInput::placeholder{color:#94a3b8;text-align:center}
.rangeSeparator{color:#94a3b8;font-weight:500}

.loadingContainer{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 1rem;background:#fff;border-radius:12px;border:1px solid #e2e8f0}
.loadingSpinner{width:48px;height:48px;border:3px solid #e2e8f0;border-top-color:#3b82f6;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:1rem}
@keyframes spin{to{transform:rotate(360deg)}}
.loadingText{font-size:.875rem;color:#64748b;text-align:center}

.emptyResults{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 1rem;background:#fff;border-radius:12px;border:1px solid #e2e8f0;text-align:center}
.emptyIcon{font-size:3rem;margin-bottom:1rem;opacity:.5}
.emptyTitle{font-size:1.125rem;font-weight:600;color:#1e293b;margin:0 0 .5rem 0}
.emptyText{font-size:.875rem;color:#64748b;margin:0}

/* ==========  CARDS  ========== */
.resultCards{display:flex;flex-direction:column;gap:.75rem;margin-bottom:calc(5rem + env(safe-area-inset-bottom,0))}
.resultCard{background:#fff;border:1px solid #e2e8f0;border-radius:12px;padding:1rem;box-shadow:0 1px 3px rgba(0,0,0,.05);transition:all .2s}
.resultCard.selectedCard{border-color:#3b82f6;background:#eff6ff;box-shadow:0 0 0 2px rgba(59,130,246,.1)}
.cardHeader{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.75rem;padding-bottom:.75rem;border-bottom:1px solid #f1f5f9}
.cardHeaderLeft{display:flex;align-items:flex-start;gap:.75rem}
.cardCheckbox{width:20px;height:20px;margin-top:.125rem;accent-color:#3b82f6;cursor:pointer}
.studentName{font-weight:600;color:#1e293b;font-size:.875rem}
.cardDate{font-size:.75rem;color:#64748b}
.cardHeaderRight{display:flex;align-items:center}
.newBadge{font-size:.625rem;font-weight:700;color:#fff;background:linear-gradient(135deg,#10b981,#059669);padding:.125rem .375rem;border-radius:10px;text-transform:uppercase;letter-spacing:.05em;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}

.cardContent{display:flex;flex-direction:column;gap:.75rem}
.exerciseInfo{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}
.exerciseName{font-weight:500;color:#334155;font-size:.875rem}
.groupTag{font-size:.75rem;padding:.125rem .5rem;background:#e0f2fe;color:#0369a1;border-radius:10px;font-weight:500}

.cardNote{display:flex;align-items:flex-start;gap:.5rem;padding:.5rem;background:#fef3c7;border-radius:6px;border-left:3px solid #f59e0b}
.noteIcon{font-size:.875rem;line-height:1}
.noteText{font-size:.75rem;color:#92400e;line-height:1.4;flex:1}

.cardStats{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem;margin:.5rem 0}
.statItem{display:flex;flex-direction:column;gap:.375rem}
.statLabel{font-size:.75rem;color:#64748b;font-weight:500}
.statValue{font-size:1.125rem;font-weight:700;color:#1e40af}
.statValue.statMax{color:#059669}
.statBar{width:100%;height:4px;background:#e2e8f0;border-radius:2px;overflow:hidden}
.statBarFill{height:100%;background:linear-gradient(90deg,#3b82f6,#8b5cf6);border-radius:2px;transition:width .5s ease}
.statBarFill.timeOk{background:linear-gradient(90deg,#10b981,#34d399)}
.statBarFill.timeOver{background:linear-gradient(90deg,#ef4444,#f87171)}

.cardActions{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem;margin-top:.5rem}
.cardActionBtn{display:flex;flex-direction:column;align-items:center;gap:.25rem;padding:.625rem;border:1px solid #e2e8f0;border-radius:8px;background:#fff;cursor:pointer;transition:all .2s;min-height:44px;justify-content:center}
.cardActionBtn:hover{background:#f8fafc;border-color:#cbd5e1;transform:translateY(-1px)}
.cardActionBtn:active{transform:scale(.95)}
.actionIcon{font-size:1rem;line-height:1}
.actionText{font-size:.75rem;color:#475569;font-weight:500}

/* ==========  TABLE  ========== */
.tableContainer{background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.05)}
.tableWrapper{overflow-x:auto;-webkit-overflow-scrolling:touch}
.table{width:100%;border-collapse:collapse;font-size:.875rem;min-width:1000px}
.table th{padding:1rem .75rem;background:#f8fafc;font-weight:600;color:#475569;text-align:left;border-bottom:2px solid #e2e8f0;white-space:nowrap;position:sticky;top:0;z-index:10}
.headerCheckbox{width:18px;height:18px;accent-color:#3b82f6;cursor:pointer}
.table td{padding:.875rem .75rem;border-bottom:1px solid #f1f5f9;vertical-align:middle}
.tableRow{transition:background-color .2s}
.tableRow:hover{background:#f8fafc}
.tableRow.selectedRow{background:#eff6ff}
.colCheckbox{width:50px;text-align:center}
.colDate{width:120px}
.colStudent{width:140px}
.colGroup{width:100px}
.colExercise{width:180px;min-width:180px}
.colHits{width:120px}
.colTime{width:120px}
.colActions{width:130px}
.checkboxWrapper{display:flex;align-items:center;justify-content:center}
.checkbox{width:18px;height:18px;cursor:pointer;accent-color:#3b82f6}
.dateCell{display:flex;flex-direction:column;gap:.25rem;position:relative}
.date{font-weight:500;color:#1e293b;font-size:.813rem}
.time{font-size:.75rem;color:#64748b}
.newIndicator{position:absolute;top:-6px;right:-6px;font-size:.625rem;font-weight:700;color:#fff;background:linear-gradient(135deg,#10b981,#059669);padding:.125rem .375rem;border-radius:10px;text-transform:uppercase;letter-spacing:.05em}
.studentCell{display:flex;align-items:center;gap:.5rem}
.studentName{font-weight:500;color:#334155;font-size:.875rem}
.noteIndicator{cursor:help;width:20px;height:20px;display:flex;align-items:center;justify-content:center;background:#fef3c7;border-radius:50%;transition:all .2s}
.noteIndicator:hover{background:#f59e0b}
.noteIcon{font-size:.75rem;line-height:1}
.groupBadge{display:inline-block;padding:.25rem .5rem;background:#e0f2fe;color:#0369a1;border-radius:10px;font-size:.75rem;font-weight:500;white-space:nowrap}
.noGroup{color:#94a3b8;font-size:.75rem}
.exerciseCell{display:flex;flex-direction:column;gap:.375rem}
.exerciseName{font-weight:500;color:#1e293b;font-size:.813rem}
.exerciseStats{display:flex;gap:.375rem;flex-wrap:wrap}
.statBadge{font-size:.688rem;padding:.125rem .375rem;background:#f1f5f9;color:#475569;border-radius:6px;white-space:nowrap}
.hitsCell{display:flex;flex-direction:column;gap:.375rem;align-items:center}
.hitsValue{font-size:1.125rem;font-weight:700;color:#1e40af;line-height:1}
.hitsValue.hitsMax{color:#059669}
.hitsProgress{width:100%;height:6px;background:#e2e8f0;border-radius:3px;overflow:hidden}
.hitsProgressBar{height:100%;background:linear-gradient(90deg,#3b82f6,#8b5cf6);border-radius:3px;transition:width .5s ease}
.timeCell{display:flex;flex-direction:column;gap:.375rem;align-items:center}
.timeValue{font-size:1rem;font-weight:600;color:#7c3aed;line-height:1}
.timeProgress{width:100%;height:6px;background:#e2e8f0;border-radius:3px;overflow:hidden}
.timeProgressBar{height:100%;border-radius:3px;transition:width .5s ease}
.timeProgressBar.timeOk{background:linear-gradient(90deg,#10b981,#34d399)}
.timeProgressBar.timeOver{background:linear-gradient(90deg,#ef4444,#f87171)}
.timeLabel{font-size:.75rem;color:#64748b}
.actionsCell{display:flex;gap:.5rem;justify-content:center}
.actionBtn{width:32px;height:32px;border:none;border-radius:8px;background:#f1f5f9;color:#475569;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.875rem;transition:all .2s;min-height:44px}
.actionBtn:hover{background:#3b82f6;color:#fff;transform:translateY(-1px)}
.actionBtn:active{transform:scale(.95)}
.actionIcon{font-size:.875rem;line-height:1}
.tableFooter{padding:1rem;border-top:1px solid #e2e8f0;background:#f8fafc}
.footerStats{display:flex;justify-content:space-around;flex-wrap:wrap;gap:1rem}
.footerStat{display:flex;flex-direction:column;align-items:center;gap:.25rem}
.footerStatLabel{font-size:.75rem;color:#64748b;font-weight:500}
.footerStatValue{font-size:1rem;font-weight:700;color:#3b82f6}

/* ==========  ACTIONS BAR  ========== */
.actionsBar{position:fixed;bottom:0;left:0;right:0;background:#fff;padding:.75rem 1rem calc(.75rem + env(safe-area-inset-bottom,0));border-top:1px solid #e2e8f0;box-shadow:0 -2px 10px rgba(0,0,0,.1);z-index:100}
.actionsBarContent{display:flex;flex-direction:column;gap:.75rem;max-width:640px;margin:0 auto}
.actionsBarInfo{display:flex;justify-content:space-between;align-items:center}
.actionsBarText{font-size:.875rem;color:#475569}
.clearSelectionBtn{font-size:.75rem;color:#ef4444;background:none;border:1px solid #fca5a5;padding:.25rem .75rem;border-radius:6px;cursor:pointer;transition:all .2s}
.clearSelectionBtn:hover{background:#fee2e2}
.desktopActions{display:flex;flex-direction:column;gap:1rem;margin-top:1.5rem;padding:1.25rem;background:#fff;border-radius:12px;border:1px solid #e2e8f0}
.desktopActionsInfo{display:flex;justify-content:space-between;align-items:center}
.selectionInfo{font-size:.875rem;color:#475569}
.primaryActionBtn{display:flex;align-items:center;justify-content:center;gap:.5rem;width:100%;padding:.875rem 1.5rem;background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:#fff;border:none;border-radius:8px;font-size:.875rem;font-weight:600;cursor:pointer;transition:all .2s;box-shadow:0 2px 4px rgba(59,130,246,.3);min-height:44px}
.primaryActionBtn:hover:not(.disabled){background:linear-gradient(135deg,#2563eb,#1e40af);transform:translateY(-1px);box-shadow:0 4px 8px rgba(59,130,246,.4)}
.primaryActionBtn:active:not(.disabled){transform:translateY(0)}
.primaryActionBtn.disabled{background:#94a3b8;cursor:not-allowed;box-shadow:none}
.actionBtnIcon{font-size:1rem}

/* ==========  MOBILE ENHANCEMENTS  ========== */
@media(max-width:768px){
  :root{--safe-bottom:env(safe-area-inset-bottom,0)}
  .page{padding:.5rem;padding-bottom:calc(4.5rem + var(--safe-bottom))}
  .header{position:sticky;top:0;z-index:10;background:#fff;margin:-.5rem -.5rem .75rem -.5rem;padding:.75rem 1rem;border-bottom:1px solid #e2e8f0;box-shadow:0 2px 4px rgba(0,0,0,.05)}
  .h2{font-size:1.25rem}
  .resultsSummary{padding:.5rem .75rem;gap:1rem;font-size:.75rem}
  .summaryValue{font-size:1.1rem}
  .filtersContainer{padding:0;border-radius:0;box-shadow:none;border:none}
  .filtersHeader{padding:.75rem 1rem;cursor:pointer;user-select:none;-webkit-tap-highlight-color:transparent}
  .filtersHeader::after{content:'‚ñæ';margin-left:auto;transition:transform .2s}
  .filtersHeader.open::after{transform:rotate(180deg)}
  .filterGrid{max-height:0;overflow:hidden;transition:max-height .25s ease-out;padding:0 1rem}
  .filterGrid.open{max-height:600px;padding:.75rem 1rem 1rem}
  .resultCard{padding:.75rem}
  .cardActions{grid-template-columns:repeat(3,1fr);gap:.25rem}
  .cardActionBtn{font-size:.6875rem}
  .actionsBar{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-top:1px solid rgba(0,0,0,.05);padding:.5rem 1rem calc(.5rem + var(--safe-bottom))}
  .primaryActionBtn{height:48px;font-size:1rem;border-radius:12px}
}

/* ==========  DARK  ========== */
@media(prefers-color-scheme:dark){
  .page{background:#0f172a}
  .h2,.filtersTitle,.emptyTitle{color:#f1f5f9}
  .resultsSummary,.filtersContainer,.loadingContainer,.emptyResults,.resultCard,.tableContainer,.desktopActions{background:#1e293b;border-color:#334155;color:#cbd5e1}
  .studentName,.exerciseName,.date{color:#e2e8f0}
  .table th{background:#1e293b;color:#94a3b8;border-color:#334155}
  .table td{border-color:#334155;color:#cbd5e1}
  .tableRow:hover{background:#334155}
  .tableRow.selectedRow{background:#1e40af}
  .actionsBar{background:#1e293b;border-color:#334155}
  .clearSelectionBtn{color:#fca5a5;border-color:#7f1d1d}
  .clearSelectionBtn:hover{background:#7f1d1d}
}

--------------------------------------------------
HitViewer.module.css  (–ø–æ–ª–Ω–æ—Å—Ç—å—é)
--------------------------------------------------
/* –û–≤–µ—Ä–ª–µ–π */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(4px);z-index:2000;display:flex;align-items:center;justify-content:center;padding:1rem;overflow:auto;animation:fadeIn .3s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
.modalBox{background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.4);width:95vw;max-width:1400px;height:95vh;max-height:900px;display:flex;flex-direction:column;overflow:hidden;animation:slideUp .4s cubic-bezier(.175,.885,.32,1.275)}
@keyframes slideUp{from{opacity:0;transform:translateY(40px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}
@media(max-width:1024px){.modalBox{max-width:95vw;max-height:90vh;height:auto}}

/* –®–∞–ø–∫–∞ */
.modalHeader{display:flex;justify-content:space-between;align-items:center;padding:1.5rem 2rem;border-bottom:1px solid #e5e7eb;background:linear-gradient(135deg,#1e293b,#334155);color:#fff;flex-shrink:0}
@media(max-width:768px){.modalHeader{padding:1rem 1.25rem}}
.modalTitle{margin:0;font-size:1.5rem;font-weight:700;color:#fff}
.closeBtn{background:rgba(255,255,255,.1);border:none;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#fff;transition:all .2s}
.closeBtn:hover{background:rgba(255,255,255,.2);transform:rotate(90deg)}
.closeBtn:active{transform:scale(.95) rotate(90deg)}

/* 3-–∫–æ–ª–æ–Ω–∫–∏ */
.threeColumnLayout{display:flex;flex:1;min-height:0;height:calc(100% - 80px);overflow:hidden}
@media(max-width:1024px){.threeColumnLayout{flex-direction:column;height:auto}}

/* –õ–µ–≤–∞—è */
.leftColumn{flex:0 0 320px;display:flex;flex-direction:column;background:#f8fafc;border-right:1px solid #e5e7eb;overflow:hidden;padding:1.5rem}
@media(max-width:1024px){.leftColumn{flex:0 0 auto;border-right:none;border-bottom:1px solid #e5e7eb;max-height:300px;min-height:300px}}
@media(max-width:768px){.leftColumn{padding:1rem;max-height:250px;min-height:250px}}

/* –¶–µ–Ω—Ç—Ä */
.centerColumn{flex:1;display:flex;flex-direction:column;padding:1.5rem;min-width:0;background:#fff;overflow:hidden}
@media(max-width:1024px){.centerColumn{flex:1;min-height:400px;max-height:500px}}
@media(max-width:768px){.centerColumn{min-height:350px;max-height:400px;padding:1rem}}

/* –ü—Ä–∞–≤–∞—è */
.rightColumn{flex:0 0 320px;display:flex;flex-direction:column;background:#f8fafc;border-left:1px solid #e5e7eb;overflow:hidden;padding:1.5rem}
@media(max-width:1024px){.rightColumn{flex:0 0 auto;border-left:none;border-top:1px solid #e5e7eb;max-height:300px;min-height:300px}}
@media(max-width:768px){.rightColumn{padding:1rem;max-height:250px;min-height:250px}}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–∏—à–µ–Ω–∏ */
.targetContainer{position:relative;flex:1;display:flex;align-items:center;justify-content:center;background:#f8fafc;border-radius:12px;overflow:hidden;border:1px solid #e2e8f0;width:100%;height:100%}
.targetCanvas,.heatCanvas,.centerCanvas,.dotsCanvas{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;image-rendering:-moz-crisp-edges;image-rendering:-webkit-crisp-edges;image-rendering:pixelated;image-rendering:crisp-edges}
.targetCanvas{z-index:1}.heatCanvas{z-index:2}.centerCanvas{z-index:3}.dotsCanvas{z-index:4}

/* –í–∏–¥–∂–µ—Ç—ã */
.heatmapWidgets{display:flex;flex-direction:column;gap:1.5rem;height:100%;overflow-y:auto}
.widgetCard{background:#fff;border-radius:12px;padding:1.5rem;border:1px solid #e2e8f0;box-shadow:0 1px 3px rgba(0,0,0,.1)}
.widgetTitle{margin:0 0 1.5rem 0;font-size:1.125rem;font-weight:600;color:#1e293b;text-align:center}
.sliderGroup{display:flex;flex-direction:column;gap:1.25rem;margin-bottom:1.5rem}
.sliderControl{display:flex;flex-direction:column;gap:.75rem}
.sliderLabel{display:flex;justify-content:space-between;align-items:center;font-size:.875rem;font-weight:500;color:#334155}
.sliderValue{background:#e2e8f0;padding:.25rem .75rem;border-radius:12px;font-size:.75rem;font-weight:600;color:#475569;min-width:50px;text-align:center}
.slider{width:100%;height:6px;-webkit-appearance:none;appearance:none;background:linear-gradient(90deg,#3b82f6,#8b5cf6);border-radius:3px;outline:none}
.slider::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:#fff;border:2px solid #3b82f6;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.2);transition:all .2s}
.slider::-webkit-slider-thumb:hover{transform:scale(1.1);box-shadow:0 4px 8px rgba(0,0,0,.3)}

/* –°–ø–∏—Å–∫–∏ */
.shootingsHeader{display:flex;align-items:center;gap:.75rem;margin-bottom:1.25rem;padding-bottom:.75rem;border-bottom:1px solid #e2e8f0}
.shootingsTitle{margin:0;font-size:1.125rem;font-weight:600;color:#1e293b}
.shootingsCount{background:#3b82f6;color:#fff;padding:.125rem .625rem;border-radius:12px;font-size:.75rem;font-weight:700}
.activeCount{margin-left:auto;font-size:.875rem;color:#495057;background:#e7f5ff;padding:2px 8px;border-radius:10px}
.emptyShootings{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem 1rem;text-align:center;color:#64748b}
.emptyIcon{font-size:3rem;margin-bottom:1rem;opacity:.5}
.emptyText{font-size:1.125rem;font-weight:600;color:#475569;margin:0 0 .5rem 0}
.emptyHint{font-size:.875rem;margin:0;line-height:1.4}
.shootingsList{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:.75rem;padding-right:.5rem;margin-bottom:1rem}
.shootingsList::-webkit-scrollbar{width:6px}
.shootingsList::-webkit-scrollbar-track{background:#f1f5f9;border-radius:3px}
.shootingsList::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}
.shootingsList::-webkit-scrollbar-thumb:hover{background:#94a3b8}
.shootingItem{display:flex;align-items:flex-start;gap:.75rem;padding:1rem;background:#fff;border:1px solid #e2e8f0;border-radius:12px;cursor:pointer;transition:all .2s}
.shootingItem:hover{border-color:#cbd5e1;background:#f8fafc;transform:translateX(2px)}
.shootingItem.selected{border-color:#3b82f6;background:#eff6ff;box-shadow:0 0 0 2px rgba(59,130,246,.1)}
.itemCheckbox{padding-top:.25rem}
.checkbox{width:18px;height:18px;accent-color:#3b82f6;cursor:pointer}
.itemContent{flex:1;display:flex;flex-direction:column;gap:.5rem;min-width:0}
.itemHeader{display:flex;justify-content:space-between;align-items:flex-start;gap:.5rem;flex-wrap:wrap}
.studentName{font-weight:600;color:#1e293b;font-size:.875rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.exerciseName{font-size:.75rem;color:#475569;background:#f1f5f9;padding:.125rem .5rem;border-radius:8px;white-space:nowrap}
.itemDetails{display:flex;gap:1rem;font-size:.75rem;color:#64748b}
.itemStats{display:flex;gap:.75rem;flex-wrap:wrap}
.stat{display:flex;align-items:center;gap:.25rem;font-size:.75rem;font-weight:500;color:#475569;background:#f1f5f9;padding:.25rem .75rem;border-radius:8px}
.statIcon{font-size:.875rem;line-height:1}
.groupTag{font-size:.75rem;color:#0369a1;background:#e0f2fe;padding:.25rem .75rem;border-radius:8px;font-weight:500}
.errorItem{display:flex;align-items:center;gap:.75rem;padding:1rem;background:#fef3c7;border:1px solid #f59e0b;border-radius:12px}
.errorIcon{font-size:1.25rem;flex-shrink:0}
.errorText{font-size:.875rem;color:#92400e;line-height:1.4}
.actionsFooter{display:flex;gap:.75rem;padding-top:1rem;margin-top:auto;border-top:1px solid #e2e8f0}
.selectAllBtn,.exportBtn{flex:1;padding:.75rem 1rem;border:none;border-radius:8px;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.5rem}
.selectAllBtn{background:#f1f5f9;color:#475569}
.selectAllBtn:hover{background:#e2e8f0}
.exportBtn{background:linear-gradient(135deg,#10b981,#059669);color:#fff}
.exportBtn:hover{background:linear-gradient(135deg,#059669,#047857);transform:translateY(-1px)}
.exportBtn:active{transform:translateY(0)}
.exportIcon{font-size:1rem;line-height:1}

/* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
@media(prefers-color-scheme:dark){
  .modalBox{background:#1e293b;color:#e2e8f0}
  .modalHeader{background:linear-gradient(135deg,#0f172a,#1e293b);border-bottom-color:#334155}
  .closeBtn{background:rgba(255,255,255,.05);color:#cbd5e1}
  .leftColumn,.rightColumn{background:#0f172a;border-color:#334155}
  .centerColumn{background:#1e293b}
  .targetContainer{background:#1e293b;border-color:#334155}
  .widgetCard{background:#1e293b;border-color:#334155}
  .widgetTitle{color:#e2e8f0}
  .sliderLabel{color:#cbd5e1}
  .sliderValue{background:#334155;color:#94a3b8}
  .shootingsTitle{color:#e2e8f0}
  .shootingItem{background:#1e293b;border-color:#334155}
  .shootingItem:hover{background:#334155;border-color:#475569}
  .shootingItem.selected{background:#1e40af;border-color:#3b82f6}
  .studentName{color:#e2e8f0}
  .exerciseName{background:#334155;color:#94a3b8}
  .stat{background:#334155;color:#cbd5e1}
  .groupTag{background:#1e3a8a;color:#bfdbfe}
  .errorItem{background:#78350f;border-color:#92400e}
  .errorText{color:#fef3c7}
  .selectAllBtn{background:#334155;color:#cbd5e1}
  .selectAllBtn:hover{background:#475569}
  .emptyText{color:#cbd5e1}
  .emptyHint{color:#94a3b8}
  .shootingsList::-webkit-scrollbar-track{background:#334155}
  .shootingsList::-webkit-scrollbar-thumb{background:#475569}
  .shootingsList::-webkit-scrollbar-thumb:hover{background:#64748b}
}

/* –ú–æ–±–∏–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è */
@media(max-width:768px){
  .overlay{padding:0}
  .modalBox{width:100%;height:100%;max-width:none;max-height:none;border-radius:0}
  .threeColumnLayout{flex-direction:column;height:100%}
  .leftColumn{max-height:35vh;border:none;border-bottom:1px solid #e2e8f0}
  .centerColumn{min-height:40vh;max-height:50vh}
  .rightColumn{max-height:25vh;border:none;border-top:1px solid #e2e8f0}
  .widgetTitle{font-size:1rem;margin-bottom:.75rem}
  .sliderGroup{gap:.75rem}
  .sliderLabel{font-size:.8125rem}
  .legendItems{display:grid;grid-template-columns:repeat(2,1fr);gap:.5rem}
  .itemHeader{flex-direction:column;align-items:flex-start;gap:.25rem}
  .itemStats{flex-direction:column;align-items:flex-start}
}

.inactive{opacity:.6;background-color:#f8f9fa}
.inactive:hover{opacity:.8;background-color:#f1f3f5}
.inactiveBadge{background:#dee2e6;color:#495057;padding:2px 6px;border-radius:10px;font-size:.75rem;margin-left:8px}
.targetInfo{text-align:center;margin-top:10px;color:#495057;font-size:.875rem;background:#f8f9fa;padding:5px 10px;border-radius:5px}

--------------------------------------------------
–†–µ–∑—é–º–µ
--------------------------------------------------
1. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å—Ç–∞—Ä—ã–µ `.tsx`-—Ñ–∞–π–ª—ã ‚Äì **–Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è**, –∫—Ä–æ–º–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ—á–∫–∏:  
   –¥–æ–±–∞–≤—å—Ç–µ –≤ `ResultsPage.tsx`  
   `const [filtersOpen, setFiltersOpen] = useState(true);`  
   –∏ –Ω–∞ `.filtersHeader` –ø–æ–≤–µ—Å—å—Ç–µ `onClick={()=>setFiltersOpen(o=>!o)}` + –∫–ª–∞—Å—Å `open` (–ø–æ–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ).

2. –ó–∞–º–µ–Ω–∏—Ç–µ –¥–≤–∞ `.module.css`-—Ñ–∞–π–ª–∞ –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω—ã–º–∏ –≤—ã—à–µ ‚Äì **–≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ —É–∂–µ –≤–Ω—É—Ç—Ä–∏**.

3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `index.html` –µ—Å—Ç—å –º–µ—Ç–∞-—Ç–µ–≥ `viewport` —Å `viewport-fit=cover` (–ø—Ä–∏–º–µ—Ä –≤ —Ç–µ–∫—Å—Ç–µ).

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
- –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã –ª—é–±–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞,  
- —É—á–∏—Ç—ã–≤–∞–µ—Ç ¬´—Å–µ–π—Ñ-—ç–π—Ä–∏—é¬ª –Ω–∞ iPhone-X+ ,  
- –≤—Å–µ –∫–Ω–æ–ø–∫–∏ ‚â• 44 px,  
- —Ñ–∏–ª—å—Ç—Ä—ã —Å–≤—ë—Ä–Ω—É—Ç—ã –≤ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω,  
- HitViewer —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω ‚Äì —É–¥–æ–±–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –º–∏—à–µ–Ω—å –ø–∞–ª—å—Ü–∞–º–∏.
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/README.md ===

=== –§–∞–π–ª: ./frontend/src/api.ts ===
import axios from "axios";
import type { Group, User, Exercise, Shooting } from "./types";

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL || "http://localhost:8000",
});

console.log("API_URL =", import.meta.env.VITE_API_URL);

// –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω
api.interceptors.request.use((cfg) => {
  const t = localStorage.getItem("token");
  if (t) cfg.headers.Authorization = `Bearer ${t}`;
  return cfg;
});

export default api;

// –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
export const login = (form: FormData) => api.post<{ access_token: string }>("/auth/token", form);
export const getMe = () => api.get<User>("/auth/me");

// –≥—Ä—É–ø–ø—ã
export const getGroups = () => api.get<Group[]>("/groups");
export const createGroup = (name: string) => api.post<Group>("/groups", { name });

// —Å—Ç—É–¥–µ–Ω—Ç—ã
export const getStudents = () => api.get<User[]>("/students");
export const createStudent = (payload: { username: string; password: string; group_id?: number }) =>
  api.post<User>("/students/create", payload);

// —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
export const getExercises = () => api.get<Exercise[]>("/exercises");
export const getAvailableExercises = () => api.get<Exercise[]>("/exercises/available");
export const getTeacherExercises = () => api.get<Exercise[]>("/exercises/my-teacher");
export const createExercise = (form: FormData) => api.post<Exercise>("/exercises", form);

// —Å—Ç—Ä–µ–ª—å–±—ã
export const getResults = (params?: {
  student_id?: number;
  group_id?: number;
  exercise_id?: number;
  hits_from?: number;
  hits_to?: number;
  time_from?: number;
  time_to?: number;
}) => api.get<Shooting[]>("/shootings", { params });

export const addShooting = (form: FormData) => api.post<Shooting>("/shootings", form);
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/api.ts ===

=== –§–∞–π–ª: ./frontend/src/App.css ===
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/App.css ===

=== –§–∞–π–ª: ./frontend/src/App.tsx ===
import { useEffect, useState } from "react";
import { BrowserRouter, Routes, Route, Navigate, Link, useLocation, useNavigate } from "react-router-dom";
import api from "./api";
import type { User } from "./types";
import Login from "./pages/Login";
import Register from "./pages/Register";
import TeacherDashboard from "./pages/TeacherDashboard";
import StudentDashboard from "./pages/StudentDashboard";
import ShootingForm from "./pages/ShootingForm";
import styles from "./styles/App.module.css";
import ResultsPage from "./pages/ResultsPage";
import FinishInvite from "./pages/FinishInvite";

// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–±–∏–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
function MobileNav({ onLogout }: { onLogout: () => void }) {
  const location = useLocation();
  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  if (!isMobile) return null;

  const navItems = [
    { path: '/', icon: 'üè†', label: '–ì–ª–∞–≤–Ω–∞—è' },
    { path: '/shooting', icon: 'üéØ', label: '–°—Ç—Ä–µ–ª—å–±–∞' },
    { path: '/results', icon: 'üìä', label: '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã' },
  ];

  return (
    <nav className={styles.mobileNav}>
      {navItems.map(item => (
        <Link 
          to={item.path} 
          key={item.path}
          className={`${styles.mobileNavItem} ${location.pathname === item.path ? styles.active : ''}`}
        >
          <span className={styles.mobileNavIcon}>{item.icon}</span>
          <span className={styles.mobileNavLabel}>{item.label}</span>
        </Link>
      ))}
      <button 
        className={styles.mobileNavItem}
        onClick={onLogout}
        aria-label="–í—ã–π—Ç–∏"
      >
        <span className={styles.mobileNavIcon}>üö™</span>
        <span className={styles.mobileNavLabel}>–í—ã–π—Ç–∏</span>
      </button>
    </nav>
  );
}

function App() {
  const [user, setUser] = useState<User | null>(null);
  const [isMobile, setIsMobile] = useState(window.innerWidth <= 768);
  const navigate = useNavigate();

  useEffect(() => {
    api.get("/auth/me")
       .then(r => setUser(r.data))
       .catch(() => {});
  }, []);

  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  const logout = () => {
    localStorage.removeItem("token");
    navigate("/login");
  };

  if (!user)
    return (
      <Routes>
        <Route path="/login"    element={<Login />} />
        <Route path="/register" element={<Register />} />
        <Route path="/finish-invite" element={<FinishInvite />} />
        <Route path="*"         element={<Navigate to="/login" />} />
      </Routes>
    );

  return (
    <div className={styles.appContainer}>
      {/* –í–µ—Ä—Ö–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ */}
      {!isMobile && (
        <nav className={styles.desktopNav}>
          <Link to="/" className={styles.navLink}>–ì–ª–∞–≤–Ω–∞—è</Link>
          <Link to="/shooting" className={styles.navLink}>–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–µ–ª—å–±—É</Link>
          <Link to="/results" className={styles.navLink}>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</Link>
          <button className={styles.logoutBtn} onClick={logout}>–í—ã–π—Ç–∏</button>
        </nav>
      )}

      {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */}
      <main className={`${styles.mainContent} ${isMobile ? styles.withMobileNav : ''}`}>
        <Routes>
          <Route path="/" element={user.is_teacher ? <TeacherDashboard /> : <StudentDashboard />} />
          <Route path="/shooting" element={<ShootingForm />} />
          <Route path="/results" element={<ResultsPage />} />
        </Routes>
      </main>

      {/* –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */}
      <MobileNav onLogout={logout} />
    </div>
  );
}

export default function AppWrapper() {
  return (
    <BrowserRouter>
      <App />
    </BrowserRouter>
  );
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/App.tsx ===

=== –§–∞–π–ª: ./frontend/src/assets/react.svg ===
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/assets/react.svg ===

=== –§–∞–π–ª: ./frontend/src/index.css ===
/* –î–æ–±–∞–≤–∏—Ç—å –≤ index.css –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª */
:root {
  --mobile-safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
  --mobile-safe-area-inset-top: env(safe-area-inset-top, 0px);
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overflow-x: hidden;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –¥–ª—è touch-—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
button, 
input[type="button"], 
input[type="submit"],
select {
  touch-action: manipulation;
  min-height: 44px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è touch */
  min-width: 44px;
}

/* –£–±–∏—Ä–∞–µ–º —Å–∏–Ω–µ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ —Ç–∞–ø–µ –Ω–∞ iOS */
input, 
textarea, 
button, 
select {
  -webkit-tap-highlight-color: transparent;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ –Ω–∞ iOS */
.scrollable {
  -webkit-overflow-scrolling: touch;
  overflow-y: auto;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã */
@media (max-width: 768px) {
  html {
    font-size: 14px;
  }
}

@media (max-width: 480px) {
  html {
    font-size: 12px;
  }
}

/* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
::-webkit-scrollbar {
  display: none;
}

/* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
@media (prefers-color-scheme: dark) {
  body {
    background: #111827;
    color: #f9fafb;
  }
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/index.css ===

=== –§–∞–π–ª: ./frontend/src/main.tsx ===
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)

=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/main.tsx ===

=== –§–∞–π–ª: ./frontend/src/pages/AddExercise.tsx ===
import { useState } from "react";
import { createExercise } from "../api";
import styles from "../styles/TeacherDashboard.module.css";

export default function AddExercise({ onAdd }: { onAdd: () => void }) {
  const [show, setShow] = useState(false);
  const [name, setName] = useState("");
  const [hits, setHits] = useState(10);
  const [sec, setSec] = useState(0);
  const [file, setFile] = useState<File | null>(null);

  const submit = async () => {
    if (!file || !name.trim()) return;
    const form = new FormData();
    form.set("name", name);
    form.set("max_hits", String(hits));
    form.set("time_sec", String(sec));
    form.set("target", file);
    await createExercise(form);
    setName(""); setHits(10); setSec(0); setFile(null); setShow(false);
    onAdd();
  };

  return (
    <>
      {!show ? (
        <button className={styles.btn} onClick={() => setShow(true)}>
          –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
        </button>
      ) : (
        <div className={styles.inline}>
          <input
            className={styles.input}
            placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"
            value={name}
            onChange={(e) => setName(e.target.value)}
          />
          <input
            className={styles.input}
            type="number"
            min={1}
            value={hits}
            onChange={(e) => setHits(Number(e.target.value))}
          />
          <input
            className={styles.input}
            type="number"
            min={0}
            value={sec}
            onChange={(e) => setSec(Number(e.target.value))}
          />
          <input
            type="file"
            accept="image/*"
            onChange={(e) => setFile(e.target.files?.[0] || null)}
          />
          <button className={styles.btn} onClick={submit}>
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
          </button>
          <button className={styles.btn} onClick={() => setShow(false)}>
            –û—Ç–º–µ–Ω–∞
          </button>
        </div>
      )}
    </>
  );
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/pages/AddExercise.tsx ===

=== –§–∞–π–ª: ./frontend/src/pages/FinishInvite.tsx ===
import { useState } from "react";
import { useNavigate, useSearchParams } from "react-router-dom";
import api from "../api";
import styles from "../styles/Login.module.css"; // –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ –∂–µ —Å—Ç–∏–ª–∏

export default function FinishInvite() {
  const [params] = useSearchParams();
  const code = params.get("code") ?? "";
  const [password, setPassword]   = useState(""); // –ø–∞—Ä–æ–ª—å –∏–∑ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
  const [username, setUsername]   = useState("");
  const [newPwd, setNewPwd]       = useState("");
  const nav = useNavigate();

  const submit = async () => {
    if (!code || !password || !username || !newPwd) {
      alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
      return;
    }
    try {
      await api.post("/auth/finish-invite", {
        code,
        password,
        username,
        new_password: newPwd,
      });
      alert("–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω ‚Äì –≤–æ–π–¥–∏—Ç–µ");
      nav("/login");
    } catch (e: any) {
      alert(e?.response?.data?.detail || "–û—à–∏–±–∫–∞");
    }
  };

  return (
    <div className={styles.wrapper}>
      <h2 className={styles.title}>–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</h2>

      <label className={styles.label}>–ü–∞—Ä–æ–ª—å –∏–∑ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</label>
      <input
        className={styles.input}
        value={password}
        onChange={(e) => setPassword(e.target.value)}
      />

      <label className={styles.label}>–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω</label>
      <input
        className={styles.input}
        value={username}
        onChange={(e) => setUsername(e.target.value)}
      />

      <label className={styles.label}>–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å</label>
      <input
        className={styles.input}
        type="password"
        value={newPwd}
        onChange={(e) => setNewPwd(e.target.value)}
      />

      <button className={styles.btn} onClick={submit}>
        –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
      </button>
    </div>
  );
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/pages/FinishInvite.tsx ===

=== –§–∞–π–ª: ./frontend/src/pages/HitViewer.tsx ===
import { useEffect, useRef, useState, useMemo } from "react";
import type { Shooting } from "../types";
import styles from "../styles/HitViewer.module.css";

type Props = {
  shootings: Shooting[]; // –í—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç—Ä–µ–ª—å–±—ã
  onClose: () => void;
};

export default function HitViewer({
  shootings,
  onClose,
}: Props) {
  const containerRef = useRef<HTMLDivElement>(null);
  const targetRef = useRef<HTMLCanvasElement>(null);
  const heatRef = useRef<HTMLCanvasElement>(null);
  const centerRef = useRef<HTMLCanvasElement>(null);
  const dotsRef = useRef<HTMLCanvasElement>(null);

  const [alphaHeat, setAlphaHeat] = useState(0.7);
  const [alphaCenter, setAlphaCenter] = useState(0.5);
  const [alphaDots, setAlphaDots] = useState(0.8);
  const [imageLoaded, setImageLoaded] = useState(false);
  const [targetSize, setTargetSize] = useState({ width: 800, height: 800 });
  
  // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - –í–°–ï ID –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –≤—ã–±—Ä–∞–Ω—ã
  const [visibleIds, setVisibleIds] = useState<Set<number>>(
    new Set(shootings.map(sh => sh.id))
  );

  // –ö—ç—à —Ä–∞–∑–º–µ—Ä–æ–≤ –º–∏—à–µ–Ω–∏ –ø–æ URL
  const targetSizeCache = useRef<Record<string, { width: number; height: number; offsetX: number; offsetY: number }>>({});

  // –°—Ç—Ä–µ–ª—å–±—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –º–∏—à–µ–Ω–∏
  const visibleShootings = useMemo(() => {
    return shootings.filter(sh => visibleIds.has(sh.id));
  }, [shootings, visibleIds]);

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏
  const toggleVisibility = (id: number) => {
    setVisibleIds(prev => {
      const next = new Set(prev);
      if (next.has(id)) {
        next.delete(id);
      } else {
        next.add(id);
      }
      return next;
    });
  };

  // –í—ã–±—Ä–∞—Ç—å –≤—Å–µ / —Å–Ω—è—Ç—å –≤—Å–µ
  const handleSelectAll = () => {
    if (visibleIds.size === shootings.length) {
      // –°–Ω—è—Ç—å –≤—Å–µ
      setVisibleIds(new Set());
    } else {
      // –í—ã–±—Ä–∞—Ç—å –≤—Å–µ
      setVisibleIds(new Set(shootings.map(sh => sh.id)));
    }
  };

  // –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–∏—à–µ–Ω–∏
  useEffect(() => {
    const updateTargetSize = () => {
      if (containerRef.current) {
        const containerWidth = containerRef.current.clientWidth;
        const containerHeight = containerRef.current.clientHeight;
        
        const targetHeight = Math.min(containerHeight * 0.9, 800);
        const targetWidth = targetHeight;
        
        setTargetSize({ width: targetWidth, height: targetHeight });
      }
    };

    updateTargetSize();
    window.addEventListener('resize', updateTargetSize);
    
    return () => {
      window.removeEventListener('resize', updateTargetSize);
    };
  }, []);

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –∏ —Å–º–µ—â–µ–Ω–∏–π —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
  const getTargetSize = (imgUrl: string, containerWidth: number, containerHeight: number) => {
    const cacheKey = `${imgUrl}_${containerWidth}_${containerHeight}`;
    
    if (targetSizeCache.current[cacheKey]) {
      return targetSizeCache.current[cacheKey];
    }

    const img = new Image();
    img.src = `${import.meta.env.VITE_API_URL}${imgUrl}`;
    if (!img.complete || !img.naturalWidth || !img.naturalHeight) {
      const size = Math.min(containerWidth, containerHeight);
      return { width: size, height: size, offsetX: (containerWidth - size) / 2, offsetY: (containerHeight - size) / 2 };
    }

    const containerSize = Math.min(containerWidth, containerHeight);
    const scale = Math.min(
      containerSize / img.naturalWidth,
      containerSize / img.naturalHeight
    );
    const drawWidth = img.naturalWidth * scale;
    const drawHeight = img.naturalHeight * scale;
    const offsetX = (containerWidth - drawWidth) / 2;
    const offsetY = (containerHeight - drawHeight) / 2;

    const size = { width: drawWidth, height: drawHeight, offsetX, offsetY };
    targetSizeCache.current[cacheKey] = size;
    return size;
  };

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  const loadImage = async (imgUrl: string) => {
    const img = new Image();
    await new Promise<void>((resolve, reject) => {
      img.onload = () => resolve();
      img.onerror = () => reject(new Error(`Failed to load image: ${imgUrl}`));
      img.src = `${import.meta.env.VITE_API_URL}${imgUrl}`;
      img.crossOrigin = "anonymous";
    });
    return img;
  };

  // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –º–∏—à–µ–Ω–∏
  useEffect(() => {
    if (!shootings.length) return;

    const load = async () => {
      try {
        const imgUrl = shootings[0].exercise.target_url;
        await loadImage(imgUrl);
        Object.keys(targetSizeCache.current).forEach(key => {
          if (key.startsWith(imgUrl)) {
            delete targetSizeCache.current[key];
          }
        });
        setImageLoaded(true);
      } catch (error) {
        console.error("Error loading image:", error);
      }
    };

    load();
  }, [shootings]);

  // –†–∏—Å—É–µ–º –º–∏—à–µ–Ω—å –∫–∞–∫ —Ñ–æ–Ω
  useEffect(() => {
    if (!shootings.length || !imageLoaded || !containerRef.current) return;

    const canvas = targetRef.current;
    if (canvas && containerRef.current) {
      const containerWidth = containerRef.current.clientWidth;
      const containerHeight = containerRef.current.clientHeight;
      
      const ctx = canvas.getContext("2d")!;
      if (!ctx) return;
      
      const dpr = window.devicePixelRatio || 1;
      canvas.width = containerWidth * dpr;
      canvas.height = containerHeight * dpr;
      canvas.style.width = `${containerWidth}px`;
      canvas.style.height = `${containerHeight}px`;
      ctx.scale(dpr, dpr);
      
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';
      ctx.clearRect(0, 0, containerWidth, containerHeight);

      const img = new Image();
      img.src = `${import.meta.env.VITE_API_URL}${shootings[0].exercise.target_url}`;
      img.crossOrigin = "anonymous";
      img.onload = () => {
        const { offsetX, offsetY, width, height: drawHeight } = getTargetSize(
          shootings[0].exercise.target_url, 
          containerWidth, 
          containerHeight
        );
        ctx.drawImage(img, offsetX, offsetY, width, drawHeight);
      };
    }
  }, [shootings, imageLoaded, targetSize]);

  /* ---------- –¢–û–ß–ö–ò ---------- */
  useEffect(() => {
    if (!imageLoaded || !dotsRef.current || !containerRef.current) return;

    const canvas = dotsRef.current;
    const ctx = canvas.getContext("2d")!;
    if (!ctx) return;
    
    const containerWidth = containerRef.current.clientWidth;
    const containerHeight = containerRef.current.clientHeight;
    
    const dpr = window.devicePixelRatio || 1;
    canvas.width = containerWidth * dpr;
    canvas.height = containerHeight * dpr;
    canvas.style.width = `${containerWidth}px`;
    canvas.style.height = `${containerHeight}px`;
    ctx.scale(dpr, dpr);
    
    ctx.clearRect(0, 0, containerWidth, containerHeight);
    
    ctx.globalAlpha = alphaDots;

    visibleShootings.forEach((sh) => {
      const pts: { x: number; y: number }[] = JSON.parse(sh.canvas_json);
      const { offsetX, offsetY, width, height: imgHeight } = getTargetSize(
        sh.exercise.target_url, 
        containerWidth, 
        containerHeight
      );

      pts.forEach((p) => {
        const x = offsetX + p.x * width;
        const y = offsetY + p.y * imgHeight;
        
        const distance = Math.sqrt(Math.pow(p.x - 0.5, 2) + Math.pow(p.y - 0.5, 2));
        if (distance < 0.1) {
          ctx.fillStyle = "#ef4444";
        } else if (distance < 0.2) {
          ctx.fillStyle = "#f97316";
        } else if (distance < 0.3) {
          ctx.fillStyle = "#eab308";
        } else if (distance < 0.4) {
          ctx.fillStyle = "#84cc16";
        } else {
          ctx.fillStyle = "#22c55e";
        }
        
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.strokeStyle = "white";
        ctx.lineWidth = 1;
        ctx.stroke();
      });
    });
  }, [visibleShootings, imageLoaded, alphaDots, targetSize]);

  /* ---------- –¢–ï–ü–õ–û–í–ê–Ø –ö–ê–†–¢–ê ---------- */
  useEffect(() => {
    if (!imageLoaded || !heatRef.current || !containerRef.current) return;

    const canvas = heatRef.current;
    const ctx = canvas.getContext("2d")!;
    if (!ctx) return;
    
    const containerWidth = containerRef.current.clientWidth;
    const containerHeight = containerRef.current.clientHeight;
    
    const dpr = window.devicePixelRatio || 1;
    canvas.width = containerWidth * dpr;
    canvas.height = containerHeight * dpr;
    canvas.style.width = `${containerWidth}px`;
    canvas.style.height = `${containerHeight}px`;
    ctx.scale(dpr, dpr);
    
    ctx.clearRect(0, 0, containerWidth, containerHeight);

    const allPoints = visibleShootings.flatMap((sh) =>
      JSON.parse(sh.canvas_json) as { x: number; y: number }[]
    );
    if (!allPoints.length) return;

    const pointsWithUrl: { p: { x: number; y: number }; url: string }[] = [];
    visibleShootings.forEach((sh) => {
      const pts: { x: number; y: number }[] = JSON.parse(sh.canvas_json);
      pts.forEach((p) => {
        pointsWithUrl.push({ p, url: sh.exercise.target_url });
      });
    });

    const scaledPoints = pointsWithUrl.map(({ p, url }) => {
      const { offsetX, offsetY, width, height: imgHeight } = getTargetSize(
        url, 
        containerWidth, 
        containerHeight
      );
      return {
        x: offsetX + p.x * width,
        y: offsetY + p.y * imgHeight,
      };
    });

    const cluster = Math.max(10, Math.min(containerWidth, containerHeight) * 0.02);
    const map = new Map<string, number>();
    scaledPoints.forEach((pt) => {
      const key = `${Math.floor(pt.x / cluster)}_${Math.floor(pt.y / cluster)}`;
      map.set(key, (map.get(key) || 0) + 1);
    });

    if (map.size === 0) return;

    const maxCount = Math.max(...map.values());
    
    map.forEach((cnt, key) => {
      const [cx, cy] = key.split("_").map(Number);
      const x = cx * cluster + cluster / 2;
      const y = cy * cluster + cluster / 2;
      const radius = cluster * 2;
      
      const t = cnt / maxCount;
      const r = Math.round(255 * t);
      const g = Math.round(128 * (1 - t));
      const b = Math.round(64 * (1 - t));
      
      const grad = ctx.createRadialGradient(x, y, 0, x, y, radius);
      grad.addColorStop(0, `rgba(${r}, ${g}, ${b}, ${alphaHeat})`);
      grad.addColorStop(0.7, `rgba(${r}, ${g}, ${b}, ${alphaHeat * 0.5})`);
      grad.addColorStop(1, "rgba(0,0,0,0)");
      
      ctx.globalAlpha = 1;
      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.arc(x, y, radius, 0, Math.PI * 2);
      ctx.fill();
    });
  }, [visibleShootings, alphaHeat, imageLoaded, targetSize]);

  /* ---------- –¶–ï–ù–¢–† –ü–†–ò–¶–ï–õ–ò–í–ê–ù–ò–Ø ---------- */
  useEffect(() => {
    if (!imageLoaded || !centerRef.current || !containerRef.current) return;

    const canvas = centerRef.current;
    const ctx = canvas.getContext("2d")!;
    if (!ctx) return;
    
    const containerWidth = containerRef.current.clientWidth;
    const containerHeight = containerRef.current.clientHeight;
    
    const dpr = window.devicePixelRatio || 1;
    canvas.width = containerWidth * dpr;
    canvas.height = containerHeight * dpr;
    canvas.style.width = `${containerWidth}px`;
    canvas.style.height = `${containerHeight}px`;
    ctx.scale(dpr, dpr);
    
    ctx.clearRect(0, 0, containerWidth, containerHeight);

    const allPoints = visibleShootings.flatMap((sh) =>
      JSON.parse(sh.canvas_json) as { x: number; y: number }[]
    );
    if (!allPoints.length) return;

    const pointsWithUrl: { p: { x: number; y: number }; url: string }[] = [];
    visibleShootings.forEach((sh) => {
      const pts: { x: number; y: number }[] = JSON.parse(sh.canvas_json);
      pts.forEach((p) => {
        pointsWithUrl.push({ p, url: sh.exercise.target_url });
      });
    });

    const scaledPoints = pointsWithUrl.map(({ p, url }) => {
      const { offsetX, offsetY, width, height: imgHeight } = getTargetSize(
        url, 
        containerWidth, 
        containerHeight
      );
      return {
        x: offsetX + p.x * width,
        y: offsetY + p.y * imgHeight,
      };
    });

    const cx = scaledPoints.reduce((s, pt) => s + pt.x, 0) / scaledPoints.length;
    const cy = scaledPoints.reduce((s, pt) => s + pt.y, 0) / scaledPoints.length;
    const radius = Math.max(
      ...scaledPoints.map((pt) => Math.hypot(pt.x - cx, pt.y - cy))
    ) || Math.min(containerWidth, containerHeight) * 0.1;

    const grad = ctx.createRadialGradient(cx, cy, 0, cx, cy, radius);
    grad.addColorStop(0, `rgba(255,255,0,${alphaCenter})`);
    grad.addColorStop(0.3, `rgba(255,128,0,${alphaCenter * 0.7})`);
    grad.addColorStop(0.7, `rgba(255,0,0,${alphaCenter * 0.4})`);
    grad.addColorStop(1, "rgba(0,0,255,0)");

    ctx.globalAlpha = 1;
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(cx, cy, radius, 0, Math.PI * 2);
    ctx.fill();
    
    ctx.strokeStyle = `rgba(255,255,255,${alphaCenter})`;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(cx - 15, cy);
    ctx.lineTo(cx + 15, cy);
    ctx.moveTo(cx, cy - 15);
    ctx.lineTo(cx, cy + 15);
    ctx.stroke();
    
    ctx.beginPath();
    ctx.arc(cx, cy, 3, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(255,255,255,${alphaCenter})`;
    ctx.fill();
  }, [visibleShootings, alphaCenter, imageLoaded, targetSize]);

  return (
    <div className={styles.overlay} onClick={onClose}>
      <div className={styles.modalBox} onClick={(e) => e.stopPropagation()}>
        <div className={styles.modalHeader}>
          <h3 className={styles.modalTitle}>–ê–Ω–∞–ª–∏–∑ –ø–æ–ø–∞–¥–∞–Ω–∏–π</h3>
          <button className={styles.closeBtn} onClick={onClose} aria-label="–ó–∞–∫—Ä—ã—Ç—å">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <path d="M18 6L6 18M6 6l12 12" />
            </svg>
          </button>
        </div>

        <div className={styles.threeColumnLayout}>
          {/* –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –≤—Å–µ —Å—Ç—Ä–µ–ª—å–±—ã */}
          <div className={styles.leftColumn}>
            <div className={styles.shootingsHeader}>
              <h4 className={styles.shootingsTitle}>–°—Ç—Ä–µ–ª—å–±—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</h4>
              <span className={styles.shootingsCount}>({shootings.length})</span>
              <div className={styles.activeCount}>
                –í–∏–¥–∏–º—ã—Ö: {visibleIds.size}
              </div>
            </div>

            {shootings.length === 0 ? (
              <div className={styles.emptyShootings}>
                <div className={styles.emptyIcon}>üéØ</div>
                <p className={styles.emptyText}>–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–µ–ª—å–±</p>
                <p className={styles.emptyHint}>–í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ —Ç–∞–±–ª–∏—Ü–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–µ–ª—å–±—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>
              </div>
            ) : (
              <>
                <div className={styles.shootingsList}>
                  {shootings.map((sh) => {
                    if (!sh.student || !sh.exercise) {
                      return (
                        <div key={sh.id} className={styles.errorItem}>
                          <div className={styles.errorIcon}>‚ö†Ô∏è</div>
                          <div className={styles.errorText}>
                            –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ –æ —Å—Ç—É–¥–µ–Ω—Ç–µ –∏–ª–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–∏
                          </div>
                        </div>
                      );
                    }

                    return (
                      <div 
                        key={sh.id} 
                        className={`${styles.shootingItem} ${visibleIds.has(sh.id) ? styles.selected : styles.inactive}`}
                        onClick={() => toggleVisibility(sh.id)}
                      >
                        <div className={styles.itemCheckbox}>
                          <input
                            type="checkbox"
                            checked={visibleIds.has(sh.id)}
                            onChange={() => toggleVisibility(sh.id)}
                            className={styles.checkbox}
                            onClick={(e) => e.stopPropagation()}
                          />
                        </div>
                        <div className={styles.itemContent}>
                          <div className={styles.itemHeader}>
                            <span className={styles.studentName}>{sh.student.username}</span>
                            <span className={styles.exerciseName}>{sh.exercise.name}</span>
                          </div>
                          <div className={styles.itemDetails}>
                            <span className={styles.date}>
                              {new Date(sh.created_at).toLocaleDateString("ru-RU")}
                            </span>
                            <span className={styles.time}>
                              {new Date(sh.created_at).toLocaleTimeString("ru-RU", { 
                                hour: '2-digit', 
                                minute: '2-digit' 
                              })}
                            </span>
                          </div>
                          <div className={styles.itemStats}>
                            <span className={styles.stat}>
                              <span className={styles.statIcon}>üéØ</span>
                              {sh.hits_count}/{sh.exercise.max_hits}
                            </span>
                            <span className={styles.stat}>
                              <span className={styles.statIcon}>‚è±Ô∏è</span>
                              {sh.time_spent}—Å
                            </span>
                            {sh.group && (
                              <span className={styles.groupTag}>
                                {sh.group.name}
                              </span>
                            )}
                            {!visibleIds.has(sh.id) && (
                              <span className={styles.inactiveBadge}>
                                –°–∫—Ä—ã—Ç–æ
                              </span>
                            )}
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>

                <div className={styles.actionsFooter}>
                  <button 
                    className={styles.selectAllBtn}
                    onClick={handleSelectAll}
                  >
                    {visibleIds.size === shootings.length ? '–°–Ω—è—Ç—å –≤—Å–µ' : '–í—ã–±—Ä–∞—Ç—å –≤—Å–µ'}
                  </button>
                  <button 
                    className={styles.exportBtn}
                    onClick={() => {
                      // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ —Å—Ç—Ä–µ–ª—å–±—ã
                      const exportData = visibleShootings;
                      alert(`–≠–∫—Å–ø–æ—Ä—Ç ${exportData.length} –≤–∏–¥–∏–º—ã—Ö —Å—Ç—Ä–µ–ª—å–±`);
                    }}
                  >
                    <span className={styles.exportIcon}>üì•</span>
                    –≠–∫—Å–ø–æ—Ä—Ç ({visibleShootings.length})
                  </button>
                </div>
              </>
            )}
          </div>

          {/* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –º–∏—à–µ–Ω—å */}
          <div className={styles.centerColumn}>
            <div className={styles.targetContainer} ref={containerRef}>
              <canvas ref={targetRef} className={styles.targetCanvas} />
              <canvas ref={heatRef} className={styles.heatCanvas} />
              <canvas ref={centerRef} className={styles.centerCanvas} />
              <canvas ref={dotsRef} className={styles.dotsCanvas} />
            </div>
            <div className={styles.targetInfo}>
              –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è: {visibleShootings.length} –∏–∑ {shootings.length} —Å—Ç—Ä–µ–ª—å–±
            </div>
          </div>

          {/* –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */}
          <div className={styles.rightColumn}>
            <div className={styles.heatmapWidgets}>
              <div className={styles.widgetCard}>
                <h4 className={styles.widgetTitle}>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h4>
                
                <div className={styles.sliderGroup}>
                  <div className={styles.sliderControl}>
                    <label className={styles.sliderLabel}>
                      <span>–Ø—Ä–∫–æ—Å—Ç—å —Ç–æ—á–µ–∫</span>
                      <span className={styles.sliderValue}>{Math.round(alphaDots * 100)}%</span>
                    </label>
                    <input
                      type="range"
                      min="0.1"
                      max="1"
                      step="0.05"
                      value={alphaDots}
                      onChange={(e) => setAlphaDots(Number(e.target.value))}
                      className={styles.slider}
                    />
                  </div>

                  <div className={styles.sliderControl}>
                    <label className={styles.sliderLabel}>
                      <span>–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã</span>
                      <span className={styles.sliderValue}>{Math.round(alphaHeat * 100)}%</span>
                    </label>
                    <input
                      type="range"
                      min="0"
                      max="1"
                      step="0.05"
                      value={alphaHeat}
                      onChange={(e) => setAlphaHeat(Number(e.target.value))}
                      className={styles.slider}
                    />
                  </div>

                  <div className={styles.sliderControl}>
                    <label className={styles.sliderLabel}>
                      <span>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ü–µ–Ω—Ç—Ä–∞</span>
                      <span className={styles.sliderValue}>{Math.round(alphaCenter * 100)}%</span>
                    </label>
                    <input
                      type="range"
                      min="0"
                      max="1"
                      step="0.05"
                      value={alphaCenter}
                      onChange={(e) => setAlphaCenter(Number(e.target.value))}
                      className={styles.slider}
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/pages/HitViewer.tsx ===

=== –§–∞–π–ª: ./frontend/src/pages/Login.tsx ===
import { useState } from "react";
import api from "../api";
import styles from "../styles/Login.module.css";

export default function Login() {
  const [u, setU] = useState("");
  const [p, setP] = useState("");
  const [log, setLog] = useState(""); // <-- —Å—Ç—Ä–æ—á–∫–∞-–ª–æ–≥

  const login = async () => {
    setLog("login called");            // <-- —Å–∏–≥–Ω–∞–ª
    const form = new FormData();
    form.set("username", u);
    form.set("password", p);
    try {
      const { data } = await api.post("/auth/token", form);
      setLog("token ok");              // <-- —É—Å–ø–µ—Ö
      localStorage.setItem("token", data.access_token);
      window.location.href = "/";
    } catch (e: any) {
      setLog("error: " + (e?.response?.data?.detail || "network")); // <-- –æ—à–∏–±–∫–∞
    }
  };

  return (
    <>
      {/* –í–ò–î–ò–ú–´–ô –õ–û–ì */}
      <div
        style={{
          position: "fixed",
          top: 0,
          left: 0,
          right: 0,
          background: "#111",
          color: "#0f0",
          fontSize: "14px",
          padding: "4px 8px",
          zIndex: 9999,
          whiteSpace: "pre-wrap",
        }}
      >
        {log || "..."}
      </div>

      {/* –≤–∞—à–∞ —Ñ–æ—Ä–º–∞ */}
      <div className={styles.wrapper} style={{ marginTop: 40 }}>
        <h2 className={styles.title}>–í—Ö–æ–¥</h2>

        <label className={styles.label}>–õ–æ–≥–∏–Ω</label>
        <input
          className={styles.input}
          value={u}
          onChange={(e) => setU(e.target.value)}
        />

        <label className={styles.label}>–ü–∞—Ä–æ–ª—å</label>
        <input
          className={styles.input}
          type="password"
          value={p}
          onChange={(e) => setP(e.target.value)}
        />

        {/* –ö–ù–û–ü–ö–ê –° –î–í–£–ú–Ø –°–û–ë–´–¢–ò–Ø–ú–ò */}
        <button
          className={styles.btn}
          type="button"
          onTouchEnd={(e) => {
            e.preventDefault();
            setLog("touch");
            login();
          }}
          onClick={(e) => {
            e.preventDefault();
            setLog("click");
            login();
          }}
        >
          –í–æ–π—Ç–∏
        </button>
      </div>
    </>
  );
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/pages/Login.tsx ===

=== –§–∞–π–ª: ./frontend/src/pages/Register.tsx ===
import { useState } from "react";
import api from "../api";
import styles from "../styles/Register.module.css";

export default function Register() {
  const [u, setU] = useState("");
  const [p, setP] = useState("");
  const [code, setCode] = useState("");

  const reg = async () => {
    await api.post("/auth/register", { username: u, password: p, invite_code: code });
    window.location.href = "/login";
  };

  return (
    <div className={styles.wrapper}>
      <h2 className={styles.title}>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>

      <label className={styles.label}>–õ–æ–≥–∏–Ω</label>
      <input className={styles.input} value={u} onChange={e => setU(e.target.value)} />

      <label className={styles.label}>–ü–∞—Ä–æ–ª—å</label>
      <input className={styles.input} type="password" value={p} onChange={e => setP(e.target.value)} />

      <label className={styles.label}>–ö–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</label>
      <input className={styles.input} value={code} onChange={e => setCode(e.target.value)} />

      <button className={styles.btn} onClick={reg}>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </div>
  );
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/pages/Register.tsx ===

=== –§–∞–π–ª: ./frontend/src/pages/ResultsPage.tsx ===
import { useCallback, useEffect, useState, useRef } from "react";
import { getResults, getGroups, getStudents, getAvailableExercises } from "../api"; // <-- –ò–ú–ü–û–†–¢ –ò–ó–ú–ï–ù–ï–ù
import type { Shooting, Group, User, Exercise } from "../types";
import HitViewer from "./HitViewer";
import styles from "../styles/ResultsPage.module.css";
import api from "../api";

export default function ResultsPage() {
  const [shootings, setShootings] = useState<Shooting[]>([]);
  const [groups, setGroups] = useState<Group[]>([]);
  const [students, setStudents] = useState<User[]>([]);
  const [exercises, setExercises] = useState<Exercise[]>([]);
  const [user, setUser] = useState<User | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  // —Ñ–∏–ª—å—Ç—Ä—ã
  const [selStudent, setSelStudent] = useState<number | "">("");
  const [selGroup, setSelGroup] = useState<number | "">("");
  const [selExercise, setSelExercise] = useState<number | "">("");
  const [hitsFrom, setHitsFrom] = useState<number | "">("");
  const [hitsTo, setHitsTo] = useState<number | "">("");
  const [timeFrom, setTimeFrom] = useState<number | "">("");
  const [timeTo, setTimeTo] = useState<number | "">("");

  // –≤—ã–±–æ—Ä —Å—Ç—Ä–µ–ª—å–± –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–ø–∞–¥–∞–Ω–∏–π
  const [selectedIds, setSelectedIds] = useState<Set<number>>(new Set());
  const [showHits, setShowHits] = useState(false);
  
  const allSelectedShootingsRef = useRef<Shooting[]>([]);
  const [isMobile, setIsMobile] = useState(() => window.innerWidth <= 768);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  useEffect(() => {
    const loadUser = async () => {
      try {
        const { data } = await api.get<User>("/auth/me");
        setUser(data);
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
      }
    };
    
    loadUser();
    
    const handleResize = () => setIsMobile(window.innerWidth <= 768);
    window.addEventListener('resize', handleResize);
    
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
  const loadFilters = useCallback(async () => {
    try {
      // –î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
      if (user?.is_teacher) {
        const [g, s, ex] = await Promise.all([
          getGroups().then(r => r.data),
          getStudents().then(r => r.data),
          getAvailableExercises().then(r => r.data), // <-- –ò–°–ü–û–õ–¨–ó–£–ï–ú –ù–û–í–´–ô –ú–ï–¢–û–î
        ]);
        setGroups(g);
        setStudents(s);
        setExercises(ex);
      } else {
        // –î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        const ex = await getAvailableExercises();
        setExercises(ex.data);
      }
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤:", error);
    }
  }, [user]);

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
  const loadResults = useCallback(async () => {
    setIsLoading(true);
    try {
      const params: any = {};
      
      // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –∑–∞–¥–∞–Ω—ã
      const addParam = (key: string, value: any) => {
        if (value !== "" && value != null) {
          params[key] = value;
        }
      };
      
      addParam('student_id', selStudent);
      addParam('group_id', selGroup);
      addParam('exercise_id', selExercise);
      addParam('hits_from', hitsFrom);
      addParam('hits_to', hitsTo);
      addParam('time_from', timeFrom);
      addParam('time_to', timeTo);

      console.log('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:', params);
      const { data } = await getResults(params);
      console.log('–ü–æ–ª—É—á–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', data.length);
      
      setShootings(data);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç—Ä–µ–ª—å–±—ã
      const updatedSelectedShootings = allSelectedShootingsRef.current.filter(sh => 
        data.some(newSh => newSh.id === sh.id)
      );
      allSelectedShootingsRef.current = updatedSelectedShootings;
      
      setSelectedIds(prev => {
        const next = new Set(prev);
        prev.forEach(id => {
          if (!data.some(sh => sh.id === id)) {
            next.delete(id);
          }
        });
        return next;
      });
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:", error);
      setShootings([]);
    } finally {
      setIsLoading(false);
    }
  }, [selStudent, selGroup, selExercise, hitsFrom, hitsTo, timeFrom, timeTo]);

  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  useEffect(() => {
    if (user) {
      loadFilters();
      loadResults();
    }
  }, [user, loadFilters, loadResults]);

  const resetFilters = () => {
    setSelGroup("");
    setSelStudent("");
    setSelExercise("");
    setHitsFrom("");
    setHitsTo("");
    setTimeFrom("");
    setTimeTo("");
  };

  const toggleSelect = (id: number) => {
    setSelectedIds(prev => {
      const next = new Set(prev);
      if (next.has(id)) {
        next.delete(id);
      } else {
        next.add(id);
      }
      return next;
    });
  };

  const selectedShootings = shootings.filter(sh => selectedIds.has(sh.id));

  const openPhoto = (url: string) => {
    window.open(`${import.meta.env.VITE_API_URL}${url}`, '_blank');
  };

  const openTarget = (url: string) => {
    window.open(`${import.meta.env.VITE_API_URL}${url}`, '_blank');
  };

  const isNewRecord = (createdAt: string) => {
    const recordDate = new Date(createdAt);
    const now = new Date();
    const diffHours = (now.getTime() - recordDate.getTime()) / (1000 * 60 * 60);
    return diffHours < 24;
  };

  return (
    <div className={styles.page}>
      <div className={styles.header}>
        <h2 className={styles.h2}>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç—Ä–µ–ª—å–±</h2>
        <div className={styles.resultsSummary}>
          <span className={styles.summaryItem}>
            <span className={styles.summaryLabel}>–ù–∞–π–¥–µ–Ω–æ:</span>
            <span className={styles.summaryValue}>{shootings.length}</span>
          </span>
          <span className={styles.summaryItem}>
            <span className={styles.summaryLabel}>–í—ã–±—Ä–∞–Ω–æ:</span>
            <span className={styles.summaryValue}>{selectedIds.size}</span>
          </span>
        </div>
      </div>

      {/* –ë–ª–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ */}
      <div className={styles.filtersContainer}>
        <div className={styles.filtersHeader}>
          <span className={styles.filtersTitle}>–§–∏–ª—å—Ç—Ä—ã</span>
          <button className={styles.clearFilters} onClick={resetFilters}>
            –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ
          </button>
        </div>

        <div className={styles.filterGrid}>
          {/* –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ */}
          <div className={styles.filterGroup}>
            <label className={styles.filterLabel}>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</label>
            <select 
              className={styles.filterSelect}
              value={selExercise} 
              onChange={e => setSelExercise(Number(e.target.value) || "")}
            >
              <option value="">–í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</option>
              {exercises.map(ex => (
                <option key={ex.id} value={ex.id}>{ex.name}</option>
              ))}
            </select>
          </div>

          {/* –ü–æ–ø–∞–¥–∞–Ω–∏—è */}
          <div className={styles.filterGroup}>
            <label className={styles.filterLabel}>–ü–æ–ø–∞–¥–∞–Ω–∏—è</label>
            <div className={styles.rangeInputs}>
              <input 
                type="number" 
                className={styles.rangeInput}
                placeholder="–û—Ç" 
                min={0} 
                value={hitsFrom} 
                onChange={e => setHitsFrom(e.target.value === "" ? "" : Number(e.target.value))} 
              />
              <span className={styles.rangeSeparator}>‚Äî</span>
              <input 
                type="number" 
                className={styles.rangeInput}
                placeholder="–î–æ" 
                min={0} 
                value={hitsTo} 
                onChange={e => setHitsTo(e.target.value === "" ? "" : Number(e.target.value))} 
              />
            </div>
          </div>

          {/* –í—Ä–µ–º—è */}
          <div className={styles.filterGroup}>
            <label className={styles.filterLabel}>–í—Ä–µ–º—è (—Å–µ–∫)</label>
            <div className={styles.rangeInputs}>
              <input 
                type="number" 
                className={styles.rangeInput}
                placeholder="–û—Ç" 
                min={0} 
                value={timeFrom} 
                onChange={e => setTimeFrom(e.target.value === "" ? "" : Number(e.target.value))} 
              />
              <span className={styles.rangeSeparator}>‚Äî</span>
              <input 
                type="number" 
                className={styles.rangeInput}
                placeholder="–î–æ" 
                min={0} 
                value={timeTo} 
                onChange={e => setTimeTo(e.target.value === "" ? "" : Number(e.target.value))} 
              />
            </div>
          </div>

          {/* –§–∏–ª—å—Ç—Ä—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è */}
          {user?.is_teacher && (
            <>
              <div className={styles.filterGroup}>
                <label className={styles.filterLabel}>–ì—Ä—É–ø–ø–∞</label>
                <select 
                  className={styles.filterSelect}
                  value={selGroup} 
                  onChange={e => setSelGroup(Number(e.target.value) || "")}
                >
                  <option value="">–í—Å–µ –≥—Ä—É–ø–ø—ã</option>
                  {groups.map(g => (
                    <option key={g.id} value={g.id}>{g.name}</option>
                  ))}
                </select>
              </div>

              <div className={styles.filterGroup}>
                <label className={styles.filterLabel}>–£—á–µ–Ω–∏–∫</label>
                <select 
                  className={styles.filterSelect}
                  value={selStudent} 
                  onChange={e => setSelStudent(Number(e.target.value) || "")}
                >
                  <option value="">–í—Å–µ —É—á–µ–Ω–∏–∫–∏</option>
                  {students.map(s => (
                    <option key={s.id} value={s.id}>{s.username}</option>
                  ))}
                </select>
              </div>
            </>
          )}
        </div>
      </div>

      {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */}
      {isLoading ? (
        <div className={styles.loadingContainer}>
          <div className={styles.loadingSpinner}></div>
          <p className={styles.loadingText}>–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...</p>
        </div>
      ) : (
        <>
          {/* –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è - –∫–∞—Ä—Ç–æ—á–∫–∏ */}
          {isMobile ? (
            <div className={styles.resultCards}>
              {shootings.length > 0 ? (
                shootings.map(sh => (
                  <div 
                    key={sh.id} 
                    className={`${styles.resultCard} ${selectedIds.has(sh.id) ? styles.selectedCard : ''}`}
                  >
                    <div className={styles.cardHeader}>
                      <div className={styles.cardHeaderLeft}>
                        <input
                          type="checkbox"
                          className={styles.cardCheckbox}
                          checked={selectedIds.has(sh.id)}
                          onChange={() => toggleSelect(sh.id)}
                        />
                        <div className={styles.cardStudentInfo}>
                          <div className={styles.studentName}>{sh.student.username}</div>
                          <div className={styles.cardDate}>
                            {new Date(sh.created_at).toLocaleDateString("ru-RU")}
                          </div>
                        </div>
                      </div>
                      <div className={styles.cardHeaderRight}>
                        {isNewRecord(sh.created_at) && (
                          <span className={styles.newBadge}>NEW</span>
                        )}
                      </div>
                    </div>

                    <div className={styles.cardContent}>
                      <div className={styles.exerciseInfo}>
                        <span className={styles.exerciseName}>{sh.exercise.name}</span>
                        {sh.group && (
                          <span className={styles.groupTag}>{sh.group.name}</span>
                        )}
                      </div>

                      {sh.note && (
                        <div className={styles.cardNote}>
                          <span className={styles.noteIcon}>üìù</span>
                          <span className={styles.noteText}>{sh.note}</span>
                        </div>
                      )}

                      <div className={styles.cardStats}>
                        <div className={styles.statItem}>
                          <div className={styles.statLabel}>–ü–æ–ø–∞–¥–∞–Ω–∏–π</div>
                          <div className={`${styles.statValue} ${sh.hits_count >= sh.exercise.max_hits ? styles.statMax : ''}`}>
                            {sh.hits_count} / {sh.exercise.max_hits}
                          </div>
                          <div className={styles.statBar}>
                            <div 
                              className={styles.statBarFill}
                              style={{ width: `${(sh.hits_count / sh.exercise.max_hits) * 100}%` }}
                            ></div>
                          </div>
                        </div>

                        <div className={styles.statItem}>
                          <div className={styles.statLabel}>–í—Ä–µ–º—è</div>
                          <div className={styles.statValue}>
                            {sh.time_spent}—Å
                          </div>
                          {sh.exercise.time_sec && (
                            <div className={styles.statBar}>
                              <div 
                                className={`${styles.statBarFill} ${sh.time_spent <= sh.exercise.time_sec ? styles.timeOk : styles.timeOver}`}
                                style={{ 
                                  width: `${Math.min((sh.time_spent / sh.exercise.time_sec) * 100, 100)}%` 
                                }}
                              ></div>
                            </div>
                          )}
                        </div>
                      </div>

                      <div className={styles.cardActions}>
                        <button 
                          className={styles.cardActionBtn}
                          onClick={() => openPhoto(sh.photo_url)}
                          title="–û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ"
                        >
                          <span className={styles.actionIcon}>–§–æ—Ç–æ</span>
                          <span className={styles.actionText}>–§–æ—Ç–æ</span>
                        </button>
                        <button 
                          className={styles.cardActionBtn}
                          onClick={() => toggleSelect(sh.id)}
                          title={selectedIds.has(sh.id) ? "–°–Ω—è—Ç—å –≤—ã–±–æ—Ä" : "–í—ã–±—Ä–∞—Ç—å"}
                        >
                          <span className={styles.actionIcon}>
                            {selectedIds.has(sh.id) ? "‚úì" : "‚óã"}
                          </span>
                          <span className={styles.actionText}>
                            {selectedIds.has(sh.id) ? "–í—ã–±—Ä–∞–Ω–æ" : "–í—ã–±—Ä–∞—Ç—å"}
                          </span>
                        </button>
                      </div>
                    </div>
                  </div>
                ))
              ) : (
                <div className={styles.emptyResults}>
                  <div className={styles.emptyIcon}>üéØ</div>
                  <p className={styles.emptyTitle}>–°—Ç—Ä–µ–ª—å–±—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                  <p className={styles.emptyText}>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤</p>
                </div>
              )}
            </div>
          ) : (
            /* –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è –≤–µ—Ä—Å–∏—è - —Ç–∞–±–ª–∏—Ü–∞ */
            <div className={styles.tableContainer}>
              {shootings.length > 0 ? (
                <>
                  <div className={styles.tableWrapper}>
                    <table className={styles.table}>
                      <thead>
                        <tr>
                          <th className={styles.colCheckbox}>
                            <input
                              type="checkbox"
                              checked={selectedIds.size === shootings.length && shootings.length > 0}
                              onChange={() => {
                                if (selectedIds.size === shootings.length) {
                                  // –°–Ω–∏–º–∞–µ–º –≤—Å–µ
                                  setSelectedIds(new Set());
                                  allSelectedShootingsRef.current = [];
                                } else {
                                  // –í—ã–±–∏—Ä–∞–µ–º –≤—Å–µ
                                  const newSelectedIds = new Set(shootings.map(sh => sh.id));
                                  setSelectedIds(newSelectedIds);
                                  allSelectedShootingsRef.current = [...shootings];
                                }
                              }}
                              className={styles.headerCheckbox}
                            />
                          </th>
                          <th className={styles.colDate}>–î–∞—Ç–∞</th>
                          <th className={styles.colStudent}>–£—á–µ–Ω–∏–∫</th>
                          <th className={styles.colGroup}>–ì—Ä—É–ø–ø–∞</th>
                          <th className={styles.colExercise}>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</th>
                          <th className={styles.colHits}>–ü–æ–ø–∞–¥–∞–Ω–∏–π</th>
                          <th className={styles.colTime}>–í—Ä–µ–º—è</th>
                          <th className={styles.colActions}>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                      </thead>
                      <tbody>
                        {shootings.map(sh => (
                          <tr 
                            key={sh.id} 
                            className={`${styles.tableRow} ${selectedIds.has(sh.id) ? styles.selectedRow : ''}`}
                          >
                            <td className={styles.colCheckbox}>
                              <div className={styles.checkboxWrapper}>
                                <input
                                  type="checkbox"
                                  checked={selectedIds.has(sh.id)}
                                  onChange={() => toggleSelect(sh.id)}
                                  className={styles.checkbox}
                                />
                              </div>
                            </td>
                            <td className={styles.colDate}>
                              <div className={styles.dateCell}>
                                <div className={styles.date}>
                                  {new Date(sh.created_at).toLocaleDateString('ru-RU')}
                                </div>
                                <div className={styles.time}>
                                  {new Date(sh.created_at).toLocaleTimeString('ru-RU', { 
                                    hour: '2-digit', 
                                    minute: '2-digit' 
                                  })}
                                </div>
                                {isNewRecord(sh.created_at) && (
                                  <span className={styles.newIndicator}>NEW</span>
                                )}
                              </div>
                            </td>
                            <td className={styles.colStudent}>
                              <div className={styles.studentCell}>
                                <span className={styles.studentName}>{sh.student.username}</span>
                                {sh.note && (
                                  <div 
                                    className={styles.noteIndicator}
                                    title={sh.note}
                                    onClick={(e) => {
                                      e.stopPropagation();
                                      alert(sh.note);
                                    }}
                                  >
                                    <span className={styles.noteIcon}>üìù</span>
                                  </div>
                                )}
                              </div>
                            </td>
                            <td className={styles.colGroup}>
                              {sh.group ? (
                                <span className={styles.groupBadge}>
                                  {sh.group.name}
                                </span>
                              ) : (
                                <span className={styles.noGroup}>‚Äî</span>
                              )}
                            </td>
                            <td className={styles.colExercise}>
                              <div className={styles.exerciseCell}>
                                <div className={styles.exerciseName}>{sh.exercise.name}</div>
                                <div className={styles.exerciseStats}>
                                  <span className={styles.statBadge}>
                                    –ú–∞–∫—Å: {sh.exercise.max_hits}
                                  </span>
                                  {sh.exercise.time_sec && (
                                    <span className={styles.statBadge}>
                                      –õ–∏–º–∏—Ç: {sh.exercise.time_sec}—Å
                                    </span>
                                  )}
                                </div>
                              </div>
                            </td>
                            <td className={styles.colHits}>
                              <div className={styles.hitsCell}>
                                <div className={`${styles.hitsValue} ${sh.hits_count >= sh.exercise.max_hits ? styles.hitsMax : ''}`}>
                                  {sh.hits_count}
                                </div>
                                <div className={styles.hitsProgress}>
                                  <div 
                                    className={styles.hitsProgressBar}
                                    style={{ 
                                      width: `${Math.min((sh.hits_count / sh.exercise.max_hits) * 100, 100)}%` 
                                    }}
                                  ></div>
                                </div>
                                <div className={styles.hitsLabel}>
                                  –∏–∑ {sh.exercise.max_hits}
                                </div>
                              </div>
                            </td>
                            <td className={styles.colTime}>
                              <div className={styles.timeCell}>
                                <div className={styles.timeValue}>
                                  {sh.time_spent}—Å
                                </div>
                                {sh.exercise.time_sec && (
                                  <div className={styles.timeProgress}>
                                    <div 
                                      className={`${styles.timeProgressBar} ${sh.time_spent <= sh.exercise.time_sec ? styles.timeOk : styles.timeOver}`}
                                      style={{ 
                                        width: `${Math.min((sh.time_spent / sh.exercise.time_sec) * 100, 100)}%` 
                                      }}
                                    ></div>
                                  </div>
                                )}
                                <div className={styles.timeLabel}>
                                  {sh.exercise.time_sec ? `–∏–∑ ${sh.exercise.time_sec}—Å` : '–±–µ–∑ –ª–∏–º–∏—Ç–∞'}
                                </div>
                              </div>
                            </td>
                            <td className={styles.colActions}>
                              <div className={styles.actionsCell}>
                                <button 
                                  className={styles.actionBtn}
                                  onClick={() => openPhoto(sh.photo_url)}
                                  title="–û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ"
                                >
                                  <span className={styles.actionIcon}>üì∑</span>
                                </button>
                                <button 
                                  className={styles.actionBtn}
                                  onClick={() => openTarget(sh.exercise.target_url)}
                                  title="–û—Ç–∫—Ä—ã—Ç—å –º–∏—à–µ–Ω—å"
                                >
                                  <span className={styles.actionIcon}>üéØ</span>
                                </button>
                                <button 
                                  className={styles.actionBtn}
                                  onClick={() => toggleSelect(sh.id)}
                                  title={selectedIds.has(sh.id) ? "–°–Ω—è—Ç—å –≤—ã–±–æ—Ä" : "–í—ã–±—Ä–∞—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"}
                                >
                                  <span className={styles.actionIcon}>
                                    {selectedIds.has(sh.id) ? "‚úì" : "+"}
                                  </span>
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                  
                  {/* –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ */}
                  {shootings.length > 0 && (
                    <div className={styles.tableFooter}>
                      <div className={styles.footerStats}>
                        <div className={styles.footerStat}>
                          <span className={styles.footerStatLabel}>–°—Ä–µ–¥–Ω–µ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–π:</span>
                          <span className={styles.footerStatValue}>
                            {(shootings.reduce((sum, sh) => sum + sh.hits_count, 0) / shootings.length).toFixed(1)}
                          </span>
                        </div>
                        <div className={styles.footerStat}>
                          <span className={styles.footerStatLabel}>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è:</span>
                          <span className={styles.footerStatValue}>
                            {(shootings.reduce((sum, sh) => sum + sh.time_spent, 0) / shootings.length).toFixed(1)}—Å
                          </span>
                        </div>
                        <div className={styles.footerStat}>
                          <span className={styles.footerStatLabel}>–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</span>
                          <span className={styles.footerStatValue}>
                            {Math.max(...shootings.map(sh => sh.hits_count))}
                          </span>
                        </div>
                      </div>
                    </div>
                  )}
                </>
              ) : (
                <div className={styles.emptyResults}>
                  <div className={styles.emptyIcon}>üéØ</div>
                  <p className={styles.emptyTitle}>–°—Ç—Ä–µ–ª—å–±—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                  <p className={styles.emptyText}>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤</p>
                </div>
              )}
            </div>
          )}

          {/* –ü–∞–Ω–µ–ª—å –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */}
          {isMobile && shootings.length > 0 && (
            <div className={styles.actionsBar}>
              <div className={styles.actionsBarContent}>
                <div className={styles.actionsBarInfo}>
                  <span className={styles.actionsBarText}>
                    –í—ã–±—Ä–∞–Ω–æ: <strong>{selectedIds.size}</strong>
                  </span>
                  {selectedIds.size > 0 && (
                    <button 
                      className={styles.clearSelectionBtn}
                      onClick={() => {
                        setSelectedIds(new Set());
                        allSelectedShootingsRef.current = [];
                      }}
                    >
                      –°–±—Ä–æ—Å–∏—Ç—å
                    </button>
                  )}
                </div>
                <button 
                  className={`${styles.primaryActionBtn} ${selectedIds.size === 0 ? styles.disabled : ''}`}
                  onClick={() => selectedIds.size > 0 && setShowHits(true)}
                  disabled={selectedIds.size === 0}
                >
                  <span className={styles.actionBtnIcon}>üìä</span>
                  –ê–Ω–∞–ª–∏–∑ ({selectedIds.size})
                </button>
              </div>
            </div>
          )}

          {/* –ö–Ω–æ–ø–∫–∏ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –≤–µ—Ä—Å–∏–∏ */}
          {!isMobile && selectedIds.size > 0 && (
            <div className={styles.desktopActions}>
              <div className={styles.desktopActionsInfo}>
                <span className={styles.selectionInfo}>
                  –í—ã–±—Ä–∞–Ω–æ —Å—Ç—Ä–µ–ª—å–±: <strong>{selectedIds.size}</strong>
                </span>
                <button 
                  className={styles.clearSelectionBtn}
                  onClick={() => {
                    setSelectedIds(new Set());
                    allSelectedShootingsRef.current = [];
                  }}
                >
                  –°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä
                </button>
              </div>
              <button 
                className={styles.primaryActionBtn}
                onClick={() => setShowHits(true)}
              >
                <span className={styles.actionBtnIcon}>üìä</span>
                –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∞–ª–∏–∑ –ø–æ–ø–∞–¥–∞–Ω–∏–π
              </button>
            </div>
          )}
        </>
      )}

      {/* –ú–æ–¥–∞–ª–∫–∞ —Å HitViewer */}
      {showHits && (
        <HitViewer
          shootings={selectedShootings} // –í—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç—Ä–µ–ª—å–±—ã
          onClose={() => setShowHits(false)}
          // –ù–µ –ø–µ—Ä–µ–¥–∞–µ–º selectedIds –∏ onToggle - HitViewer –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º
        />
      )}
    </div>
  );
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/pages/ResultsPage.tsx ===

=== –§–∞–π–ª: ./frontend/src/pages/ShootingForm.tsx ===
// src/components/ShootingForm.tsx
import { useCallback, useEffect, useRef, useState } from "react";
import { getAvailableExercises } from "../api";
import type { Exercise, Group } from "../types";
import styles from "../styles/ShootingForm.module.css";
import api from "../api";

type Point = { x: number; y: number };

export default function ShootingForm() {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const containerRef = useRef<HTMLDivElement>(null);
  const [timeSpent, setTimeSpent] = useState<number | "">("");
  const [hitsCount, setHitsCount] = useState<number | "">("");
  const [note, setNote] = useState("");
  const [file, setFile] = useState<File | null>(null);
  const [marks, setMarks] = useState<Point[]>([]);
  const [exercises, setExercises] = useState<Exercise[]>([]);
  const [groups, setGroups] = useState<Group[]>([]);
  const [selEx, setSelEx] = useState<number | "">("");
  const [selGroup, setSelGroup] = useState<number | "">("");
  const [maxHits, setMaxHits] = useState(10);
  const [timerSec, setTimerSec] = useState(0);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [fileName, setFileName] = useState("");
  const [isMobile, setIsMobile] = useState(false);
  const [debugMode, setDebugMode] = useState(false);
  const [lastClickCoords, setLastClickCoords] = useState({ x: 0, y: 0 });

  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
  useEffect(() => {
    const checkMobile = () => {
      setIsMobile(window.innerWidth <= 768 || 'ontouchstart' in window);
    };
    
    checkMobile();
    window.addEventListener('resize', checkMobile);
    
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  const loadEx = useCallback(async () => {
    try {
      const { data } = await getAvailableExercises();
      setExercises(data);
    } catch (error) {
      alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π");
    }
  }, []);

  const loadGroups = useCallback(async () => {
    try {
      const { data } = await api.get("/groups");
      setGroups(data);
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø:", error);
    }
  }, []);

  useEffect(() => { 
    loadEx(); 
    loadGroups();
  }, [loadEx, loadGroups]);

  useEffect(() => {
    const ex = exercises.find(e => e.id === Number(selEx));
    if (!ex) return;
    
    setMaxHits(ex.max_hits);
    setTimerSec(ex.time_sec);
    setHitsCount(ex.max_hits);
    setTimeSpent(ex.time_sec || "");
    setMarks([]);
    
    if (ex.target_url) {
      drawTarget(ex.target_url);
    }
  }, [selEx, exercises]);

  const drawTarget = useCallback((targetUrl: string) => {
    const canvas = canvasRef.current;
    if (!canvas) {
      console.log('Canvas ref is null');
      return;
    }

    const ctx = canvas.getContext("2d");
    if (!ctx) {
      console.log('Canvas context not available');
      return;
    }

    // –°–Ω–∞—á–∞–ª–∞ –æ—á–∏—â–∞–µ–º canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const img = new Image();
    img.crossOrigin = "anonymous";
    img.src = `${import.meta.env.VITE_API_URL}${targetUrl}`;
    
    img.onload = () => {
      if (!canvas || !ctx) return;

      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è canvas
      const containerWidth = containerRef.current?.clientWidth || 300;
      const targetAspectRatio = 3/4;
      const canvasWidth = Math.min(containerWidth - 32, 400);
      const canvasHeight = canvasWidth / targetAspectRatio;

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
      if (canvas.width !== canvasWidth) canvas.width = canvasWidth;
      if (canvas.height !== canvasHeight) canvas.height = canvasHeight;

      // –†–∏—Å—É–µ–º –º–∏—à–µ–Ω—å —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–π
      const scale = Math.min(
        canvasWidth / img.naturalWidth,
        canvasHeight / img.naturalHeight
      );
      const drawWidth = img.naturalWidth * scale;
      const drawHeight = img.naturalHeight * scale;
      const offsetX = (canvasWidth - drawWidth) / 2;
      const offsetY = (canvasHeight - drawHeight) / 2;

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –æ–±–ª–∞—Å—Ç–∏ –º–∏—à–µ–Ω–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–æ–≤
      const targetArea = { offsetX, offsetY, drawWidth, drawHeight };
      (canvas as any).targetArea = targetArea;

      // –§–æ–Ω
      ctx.fillStyle = "#f9fafb";
      ctx.fillRect(0, 0, canvasWidth, canvasHeight);
      
      // –ú–∏—à–µ–Ω—å
      ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);

      // –û–±–≤–æ–¥–∫–∞ –æ–±–ª–∞—Å—Ç–∏ –º–∏—à–µ–Ω–∏ (–ª–µ–≥–∫–∞—è –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–∞)
      ctx.strokeStyle = "rgba(99, 102, 241, 0.3)";
      ctx.lineWidth = 1;
      ctx.strokeRect(offsetX, offsetY, drawWidth, drawHeight);

      // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
      if (debugMode) {
        ctx.fillStyle = "rgba(0, 0, 0, 0.1)";
        ctx.fillRect(offsetX, offsetY, drawWidth, drawHeight);
        
        // –°–µ—Ç–∫–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        ctx.strokeStyle = "rgba(255, 0, 0, 0.2)";
        ctx.lineWidth = 0.5;
        for (let i = 0; i <= 10; i++) {
          const x = offsetX + (i / 10) * drawWidth;
          const y = offsetY + (i / 10) * drawHeight;
          
          // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
          ctx.beginPath();
          ctx.moveTo(x, offsetY);
          ctx.lineTo(x, offsetY + drawHeight);
          ctx.stroke();
          
          // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
          ctx.beginPath();
          ctx.moveTo(offsetX, y);
          ctx.lineTo(offsetX + drawWidth, y);
          ctx.stroke();
        }
        
        // –û—Ç–º–µ—Ç–∫–∞ —Ü–µ–Ω—Ç—Ä–∞
        ctx.fillStyle = "blue";
        ctx.beginPath();
        ctx.arc(offsetX + drawWidth/2, offsetY + drawHeight/2, 5, 0, Math.PI * 2);
        ctx.fill();
      }

      // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –º–µ—Ç–∫–∏
      marks.forEach((mark, index) => {
        const x = offsetX + (mark.x * drawWidth);
        const y = offsetY + (mark.y * drawHeight);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ –æ–±–ª–∞—Å—Ç–∏ –º–∏—à–µ–Ω–∏
        if (x < offsetX || x > offsetX + drawWidth || y < offsetY || y > offsetY + drawHeight) {
          console.warn(`Mark ${index} out of bounds:`, { x, y, offsetX, offsetY, drawWidth, drawHeight });
          return;
        }

        // –ë–æ–ª—å—à–æ–π –∫—Ä–∞—Å–Ω—ã–π –∫—Ä—É–∂–æ–∫ —Å –æ–±–≤–æ–¥–∫–æ–π (—É–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä)
        const radius = isMobile ? 10 : 8;
        
        // –ë–µ–ª–∞—è –æ–±–≤–æ–¥–∫–∞
        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(x, y, radius + 2, 0, Math.PI * 2);
        ctx.fill();
        
        // –ö—Ä–∞—Å–Ω—ã–π –∫—Ä—É–∂–æ–∫
        ctx.fillStyle = "#ef4444";
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fill();
        
        // –ß–µ—Ä–Ω–∞—è —Ç–æ–Ω–∫–∞—è –æ–±–≤–æ–¥–∫–∞ –¥–ª—è —á–µ—Ç–∫–æ—Å—Ç–∏
        ctx.strokeStyle = "#1f2937";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.stroke();
        
        // –ù–æ–º–µ—Ä –ø–æ–ø–∞–¥–∞–Ω–∏—è (–±–µ–ª—ã–π —Ç–µ–∫—Å—Ç)
        ctx.fillStyle = "white";
        ctx.font = `bold ${isMobile ? '11' : '9'}px Arial`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText((index + 1).toString(), x, y);
      });

      console.log('Canvas drawn with', marks.length, 'marks. Target area:', targetArea);
    };

    img.onerror = () => {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∏—à–µ–Ω–∏:", targetUrl);
      const canvas = canvasRef.current;
      const ctx = canvas?.getContext("2d");
      if (!canvas || !ctx) return;
      
      ctx.fillStyle = "#f3f4f6";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#6b7280";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.font = "14px Arial";
      ctx.fillText("–ú–∏—à–µ–Ω—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞", canvas.width/2, canvas.height/2);
    };
  }, [marks, isMobile, debugMode]);

  // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –º–∏—à–µ–Ω—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–µ—Ç–æ–∫ –∏–ª–∏ –æ—Ç–ª–∞–¥–∫–∏
  useEffect(() => {
    if (selEx) {
      const ex = exercises.find(e => e.id === Number(selEx));
      if (ex && ex.target_url) {
        drawTarget(ex.target_url);
      }
    }
  }, [marks, debugMode, drawTarget, selEx, exercises]);

  const handleCanvasInteraction = useCallback((clientX: number, clientY: number) => {
    if (marks.length >= maxHits || !selEx) {
      console.log('Cannot add mark:', { marksLength: marks.length, maxHits, selEx });
      return;
    }
    
    const canvas = canvasRef.current;
    if (!canvas) {
      console.log('No canvas element');
      return;
    }
    
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    
    const x = (clientX - rect.left) * scaleX;
    const y = (clientY - rect.top) * scaleY;
    
    setLastClickCoords({ x: Math.round(x), y: Math.round(y) });

    const ex = exercises.find(e => e.id === Number(selEx));
    if (!ex || !ex.target_url) {
      console.log('No exercise or target URL');
      return;
    }

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é targetArea –∏–ª–∏ –≤—ã—á–∏—Å–ª—è–µ–º
    let targetArea = (canvas as any).targetArea;
    if (!targetArea) {
      console.log('Target area not found, calculating...');
      const img = new Image();
      img.src = `${import.meta.env.VITE_API_URL}${ex.target_url}`;
      
      if (img.complete) {
        const scale = Math.min(
          canvas.width / img.naturalWidth,
          canvas.height / img.naturalHeight
        );
        const drawWidth = img.naturalWidth * scale;
        const drawHeight = img.naturalHeight * scale;
        const offsetX = (canvas.width - drawWidth) / 2;
        const offsetY = (canvas.height - drawHeight) / 2;
        
        targetArea = { offsetX, offsetY, drawWidth, drawHeight };
      } else {
        img.onload = () => {
          const scale = Math.min(
            canvas.width / img.naturalWidth,
            canvas.height / img.naturalHeight
          );
          const drawWidth = img.naturalWidth * scale;
          const drawHeight = img.naturalHeight * scale;
          const offsetX = (canvas.width - drawWidth) / 2;
          const offsetY = (canvas.height - drawHeight) / 2;
          
          processClick({ offsetX, offsetY, drawWidth, drawHeight }, x, y);
        };
        return;
      }
    }
    
    processClick(targetArea, x, y);
  }, [marks.length, maxHits, selEx, exercises]);

  const processClick = useCallback((targetArea: { offsetX: number, offsetY: number, drawWidth: number, drawHeight: number }, x: number, y: number) => {
    console.log('Processing click:', { x, y, targetArea });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –º–∏—à–µ–Ω—å
    if (
      x < targetArea.offsetX ||
      x > targetArea.offsetX + targetArea.drawWidth ||
      y < targetArea.offsetY ||
      y > targetArea.offsetY + targetArea.drawHeight
    ) {
      console.log('Click outside target area');
      return;
    }

    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –º–∏—à–µ–Ω–∏ (0-1)
    const xInTarget = (x - targetArea.offsetX) / targetArea.drawWidth;
    const yInTarget = (y - targetArea.offsetY) / targetArea.drawHeight;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω
    const clampedX = Math.max(0, Math.min(1, xInTarget));
    const clampedY = Math.max(0, Math.min(1, yInTarget));

    console.log('Target coordinates:', { xInTarget, yInTarget, clampedX, clampedY });

    const newMark = { 
      x: Math.round(clampedX * 10000) / 10000, 
      y: Math.round(clampedY * 10000) / 10000 
    };

    console.log('Adding new mark:', newMark);
    setMarks(prev => [...prev, newMark]);
  }, []);

  const handleMouseClick = useCallback((e: React.MouseEvent<HTMLCanvasElement>) => {
    e.preventDefault();
    e.stopPropagation();
    handleCanvasInteraction(e.clientX, e.clientY);
  }, [handleCanvasInteraction]);

  const handleTouchStart = useCallback((e: React.TouchEvent<HTMLCanvasElement>) => {
    e.preventDefault();
    e.stopPropagation();
    const touch = e.touches[0];
    handleCanvasInteraction(touch.clientX, touch.clientY);
  }, [handleCanvasInteraction]);

  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const selectedFile = e.target.files?.[0];
    if (selectedFile) {
      if (selectedFile.size > 10 * 1024 * 1024) {
        alert("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º 10MB");
        return;
      }
      setFile(selectedFile);
      setFileName(selectedFile.name);
    }
  };

  const validateForm = () => {
    if (!selEx) {
      alert("–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ");
      return false;
    }
    if (!file) {
      alert("–î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —Å—Ç—Ä–µ–ª—å–±—ã");
      return false;
    }
    if (marks.length === 0) {
      alert("–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –º–µ—Ç–∫—É –Ω–∞ –º–∏—à–µ–Ω–∏");
      return false;
    }
    if (hitsCount === "" || Number(hitsCount) > maxHits) {
      alert(`–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø–∞–¥–∞–Ω–∏–π –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å ${maxHits}`);
      return false;
    }
    if (timerSec > 0 && (timeSpent === "" || Number(timeSpent) > timerSec)) {
      alert(`–í—Ä–µ–º—è —Å—Ç—Ä–µ–ª—å–±—ã –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å ${timerSec} —Å–µ–∫—É–Ω–¥`);
      return false;
    }
    return true;
  };

  const submit = async () => {
    if (!validateForm() || isSubmitting) return;
    
    setIsSubmitting(true);
    try {
      const form = new FormData();
      form.append("exercise_id", String(selEx));
      form.append("note", note);
      form.append("canvas_json", JSON.stringify(marks));
      form.append("time_spent", String(timeSpent || 0));
      form.append("hits_count", String(hitsCount));
      form.append("photo", file!);
      
      // –î–æ–±–∞–≤–ª—è–µ–º group_id –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –≥—Ä—É–ø–ø–∞
      if (selGroup) {
        form.append("group_id", String(selGroup));
      }

      await api.post("/shootings", form);
      
      alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úì");
      
      // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
      setMarks([]);
      setFile(null);
      setFileName("");
      setNote("");
      setHitsCount("");
      setTimeSpent("");
      setSelEx("");
      setSelGroup("");
      
    } catch (error) {
      console.error('Error submitting form:', error);
      alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è");
    } finally {
      setIsSubmitting(false);
    }
  };

  const removeMark = (index: number) => {
    setMarks(prev => prev.filter((_, i) => i !== index));
  };

  const clearAllMarks = () => {
    setMarks([]);
  };

  const addTestMark = (position: 'center' | 'random') => {
    if (marks.length >= maxHits) return;
    
    let x, y;
    if (position === 'center') {
      x = 0.5;
      y = 0.5;
    } else {
      x = Math.random() * 0.8 + 0.1; // 0.1 - 0.9
      y = Math.random() * 0.8 + 0.1;
    }
    
    setMarks(prev => [...prev, { x, y }]);
  };

  return (
    <div className={styles.form}>
      <h2 className={styles.title}>–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–µ–ª—å–±—É</h2>

      {/* –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å */}
      {debugMode && (
        <div className={styles.debugPanel}>
          <div className={styles.debugHeader}>
            <span>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
            <button 
              className={styles.debugClose}
              onClick={() => setDebugMode(false)}
            >
              √ó
            </button>
          </div>
          <div className={styles.debugContent}>
            <div>–ú–µ—Ç–æ–∫: {marks.length} / {maxHits}</div>
            <div>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ ID: {selEx || '–Ω–µ –≤—ã–±—Ä–∞–Ω–æ'}</div>
            <div>–ì—Ä—É–ø–ø–∞ ID: {selGroup || '–Ω–µ –≤—ã–±—Ä–∞–Ω–∞'}</div>
            <div>Canvas: {canvasRef.current ? `${canvasRef.current.width}√ó${canvasRef.current.height}` : '–Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω'}</div>
            <div>–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–ª–∏–∫: {lastClickCoords.x}, {lastClickCoords.y}</div>
            <div>–ü–æ—Å–ª–µ–¥–Ω—è—è –º–µ—Ç–∫–∞: {marks.length > 0 ? 
              `X: ${(marks[marks.length-1].x*100).toFixed(1)}%, Y: ${(marks[marks.length-1].y*100).toFixed(1)}%` : 
              '–Ω–µ—Ç'
            }</div>
            <div className={styles.debugButtons}>
              <button 
                className={styles.debugBtn}
                onClick={() => addTestMark('center')}
              >
                –¢–µ—Å—Ç: —Ü–µ–Ω—Ç—Ä
              </button>
              <button 
                className={styles.debugBtn}
                onClick={() => addTestMark('random')}
              >
                –¢–µ—Å—Ç: —Å–ª—É—á–∞–π–Ω–æ
              </button>
            </div>
          </div>
        </div>
      )}

      <div className={styles.formGroup}>
        <label className={styles.label}>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ *</label>
        <select 
          className={styles.select}
          value={selEx} 
          onChange={e => setSelEx(Number(e.target.value))}
        >
          <option value="">‚Äì –≤—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ ‚Äì</option>
          {exercises.map(ex => (
            <option key={ex.id} value={ex.id}>{ex.name}</option>
          ))}
        </select>
      </div>

      {/* –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ –≤—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø—ã */}
      <div className={styles.formGroup}>
        <label className={styles.label}>–ì—Ä—É–ø–ø–∞</label>
        <select 
          className={styles.select}
          value={selGroup} 
          onChange={e => setSelGroup(Number(e.target.value) || "")}
        >
          <option value="">‚Äì –±–µ–∑ –≥—Ä—É–ø–ø—ã ‚Äì</option>
          {groups.map(g => (
            <option key={g.id} value={g.id}>{g.name}</option>
          ))}
        </select>
      </div>

      {selEx && (
        <>
          <div className={styles.stats}>
            <div className={styles.statItem}>
              <span className={styles.statLabel}>–ú–∞–∫—Å. –ø–æ–ø–∞–¥–∞–Ω–∏–π:</span>
              <span className={styles.statValue}>{maxHits}</span>
            </div>
            <div className={styles.statItem}>
              <span className={styles.statLabel}>–í—Ä–µ–º—è:</span>
              <span className={styles.statValue}>
                {timerSec ? `${timerSec} —Å` : '‚àû'}
              </span>
            </div>
            <div className={styles.statItem}>
              <span className={styles.statLabel}>–†–µ–∂–∏–º:</span>
              <span className={styles.statValue}>
                {isMobile ? '–ú–æ–±–∏–ª—å–Ω—ã–π' : '–î–µ—Å–∫—Ç–æ–ø'}
              </span>
            </div>
          </div>

          <div className={styles.grid}>
            <div className={styles.formGroup}>
              <label className={styles.label}>–ü–æ–ø–∞–¥–∞–Ω–∏—è *</label>
              <input 
                type="number" 
                className={styles.input}
                min="0"
                max={maxHits}
                value={hitsCount}
                onChange={e => setHitsCount(e.target.value === "" ? "" : Number(e.target.value))}
                placeholder="0"
              />
              <div className={styles.hint}>
                <span className={marks.length === maxHits ? styles.hintFull : ''}>
                  –î–æ–±–∞–≤–ª–µ–Ω–æ: {marks.length} –∏–∑ {maxHits}
                </span>
              </div>
            </div>

            <div className={styles.formGroup}>
              <label className={styles.label}>
                –í—Ä–µ–º—è, —Å–µ–∫ {timerSec > 0 && `(–¥–æ ${timerSec})`}
              </label>
              <input 
                type="number" 
                className={styles.input}
                min="0"
                max={timerSec || undefined}
                value={timeSpent}
                onChange={e => setTimeSpent(e.target.value === "" ? "" : Number(e.target.value))}
                placeholder="0"
              />
            </div>
          </div>

          <div className={styles.canvasContainer} ref={containerRef}>
            <div className={styles.canvasHeader}>
              <div className={styles.canvasTitleWrapper}>
                <span className={styles.canvasTitle}>–ú–∏—à–µ–Ω—å</span>
                {marks.length > 0 && (
                  <span className={styles.marksCounter}>
                    <span className={styles.marksCounterBadge}>
                      {marks.length} –∏–∑ {maxHits}
                    </span>
                  </span>
                )}
              </div>
              <div className={styles.canvasActions}>
                {marks.length > 0 && (
                  <button 
                    className={styles.clearBtn}
                    onClick={clearAllMarks}
                    type="button"
                  >
                    –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                  </button>
                )}
                {process.env.NODE_ENV === 'development' && (
                  <button 
                    className={styles.debugToggle}
                    onClick={() => setDebugMode(!debugMode)}
                    type="button"
                  >
                    {debugMode ? '‚ùå' : 'üêõ'}
                  </button>
                )}
              </div>
            </div>
            
            <div className={styles.canvasWrapper}>
              <canvas 
                ref={canvasRef} 
                className={styles.canvas}
                onClick={handleMouseClick}
                onTouchStart={handleTouchStart}
              />
              {marks.length === 0 && (
                <div className={styles.canvasOverlay}>
                  <div className={styles.canvasInstruction}>
                    {isMobile ? (
                      <>–¢–∞–ø–Ω–∏—Ç–µ –Ω–∞ –º–∏—à–µ–Ω–∏, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ø–∞–¥–∞–Ω–∏–µ</>
                    ) : (
                      <>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–∏—à–µ–Ω–∏, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ø–∞–¥–∞–Ω–∏–µ</>
                    )}
                    <div className={styles.canvasInstructionSub}>
                      –î–æ–±–∞–≤–ª–µ–Ω–æ: {marks.length} –∏–∑ {maxHits}
                    </div>
                  </div>
                </div>
              )}
            </div>
            
            <div className={styles.canvasHint}>
              {marks.length >= maxHits ? (
                <span className={styles.hintFull}>
                  <span className={styles.hintIcon}>‚úì</span>
                  –î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º –ø–æ–ø–∞–¥–∞–Ω–∏–π
                </span>
              ) : (
                <>
                  <span className={styles.hintDot}>‚Ä¢</span>
                  {isMobile 
                    ? "–¢–∞–ø–Ω–∏—Ç–µ –Ω–∞ –º–∏—à–µ–Ω–∏ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–π" 
                    : "–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–∏—à–µ–Ω–∏ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–π"
                  }
                  <span className={styles.hintCounter}>
                    ({marks.length}/{maxHits})
                  </span>
                </>
              )}
            </div>

            {marks.length > 0 && (
              <div className={styles.marksList}>
                <div className={styles.marksHeader}>
                  <span className={styles.marksTitle}>–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ø–∞–¥–∞–Ω–∏—è:</span>
                  <span className={styles.marksCount}>{marks.length} —à—Ç.</span>
                </div>
                <div className={styles.marksGrid}>
                  {marks.map((mark, index) => (
                    <div key={index} className={styles.markItem}>
                      <div className={styles.markHeader}>
                        <div className={styles.markIndexWrapper}>
                          <span className={styles.markIndex}>#{index + 1}</span>
                          <div className={styles.markPreview}>
                            <div 
                              className={styles.markPreviewDot}
                              style={{
                                left: `${mark.x * 100}%`,
                                top: `${mark.y * 100}%`,
                              }}
                            />
                          </div>
                        </div>
                        <button 
                          className={styles.markRemove}
                          onClick={() => removeMark(index)}
                          type="button"
                          aria-label="–£–¥–∞–ª–∏—Ç—å –º–µ—Ç–∫—É"
                        >
                          √ó
                        </button>
                      </div>
                      <div className={styles.markCoords}>
                        <span data-label="X:">{(mark.x * 100).toFixed(1)}</span>
                        <span data-label="Y:">{(mark.y * 100).toFixed(1)}</span>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </>
      )}

      <div className={styles.formGroup}>
        <label className={styles.label}>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
        <textarea 
          className={styles.textarea}
          value={note}
          onChange={e => setNote(e.target.value)}
          placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏..."
          rows={3}
        />
      </div>

      <div className={styles.formGroup}>
        <label className={styles.label}>–§–æ—Ç–æ —Å—Ç—Ä–µ–ª—å–±—ã *</label>
        <div className={styles.fileUpload}>
          <input
            type="file"
            id="photo"
            accept="image/*"
            className={styles.fileInput}
            onChange={handleFileChange}
            capture={isMobile ? "environment" : undefined}
          />
          <label htmlFor="photo" className={styles.fileLabel}>
            <svg className={styles.fileIcon} viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
              <circle cx="12" cy="13" r="4"/>
            </svg>
            <span className={styles.fileText}>
              {fileName || (isMobile ? "–°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª" : "–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª")}
            </span>
            {fileName && (
              <span className={styles.fileName}>{fileName}</span>
            )}
          </label>
        </div>
        <div className={styles.fileHint}>–§–æ—Ä–º–∞—Ç: JPG, PNG ‚Ä¢ –ú–∞–∫—Å. 10MB</div>
      </div>

      <button 
        className={`${styles.submitBtn} ${isSubmitting ? styles.submitting : ''}`}
        onClick={submit}
        disabled={isSubmitting || !selEx || !file || marks.length === 0}
      >
        {isSubmitting ? (
          <>
            <span className={styles.spinner}></span>
            –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...
          </>
        ) : (
          '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä–µ–ª—å–±—É'
        )}
      </button>
    </div>
  );
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/pages/ShootingForm.tsx ===

=== –§–∞–π–ª: ./frontend/src/pages/StudentDashboard.tsx ===
import { useCallback, useEffect, useState } from "react";
import { Link } from "react-router-dom";
import api from "../api";
import type { Shooting, Group } from "../types";
import styles from "../styles/StudentDashboard.module.css";

export default function StudentDashboard() {
  const [shootings, setShootings] = useState<Shooting[]>([]);
  const [groups, setGroups] = useState<Group[]>([]);

  const load = useCallback(async () => {
    const [s, g] = await Promise.all([
      api.get("/shootings").then(r => r.data),
      api.get("/groups").then(r => r.data),
    ]);
    setShootings(s);
    setGroups(g);
  }, []);

  useEffect(() => { load(); }, [load]);

  return (
    <div className={styles.page}>
        <h2 className={styles.h2}>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Å—Ç—Ä–µ–ª–∫–∞</h2>

        <h3 className={styles.h3}>–ú–æ–∏ –≥—Ä—É–ø–ø—ã</h3>
        {groups.length ? (
        <ul className={styles.list}>
            {groups.map((gr) => (
            <li key={gr.id}>{gr.name}</li>
            ))}
        </ul>
        ) : (
        <p className={styles.empty}>–í—ã –ø–æ–∫–∞ –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç–µ –Ω–∏ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ.</p>
        )}

        <Link to="/shooting">
        <button className={styles.addBtn}>–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–µ–ª—å–±—É</button>
        </Link>

        <h3 className={styles.h3}>–ú–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
        {shootings.length ? (
        <table className={styles.table}>
            <thead>
            <tr>
                <th>–î–∞—Ç–∞</th>
                <th>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</th>
                <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
                <th>–§–æ—Ç–æ</th>
            </tr>
            </thead>
            <tbody>
            {shootings.map((sh) => (
                <tr key={sh.id}>
                <td>{new Date(sh.created_at).toLocaleString("ru-RU")}</td>
                {/*  –ì–õ–ê–í–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï  */}
                <td>{sh.exercise.name}</td>
                <td>{sh.note || "‚Äî"}</td>
                <td>
                    <a
                    href={`${import.meta.env.VITE_API_URL}${sh.photo_url}`}
                    target="_blank"
                    rel="noreferrer"
                    >
                    <img
                        className={styles.img}
                        src={`${import.meta.env.VITE_API_URL}${sh.photo_url}`}
                        alt="shot"
                    />
                    </a>
                </td>
                </tr>
            ))}
            </tbody>
        </table>
        ) : (
        <p className={styles.empty}>–ï—â—ë –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–µ–ª—å–±.</p>
        )}
    </div>
    );
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/pages/StudentDashboard.tsx ===

=== –§–∞–π–ª: ./frontend/src/pages/TeacherDashboard.tsx ===
import { useCallback, useEffect, useState } from "react";
import api, { getExercises } from "../api";
import type { Group, User, Exercise } from "../types";
import styles from "../styles/TeacherDashboard.module.css";
import AddExercise from "./AddExercise";

export default function TeacherDashboard() {
  /* ----------- –≥—Ä—É–ø–ø—ã ----------- */
  const [groups, setGroups] = useState<Group[]>([]);
  const [groupName, setGroupName] = useState("");

  /* ----------- —É—á–µ–Ω–∏–∫–∏ ----------- */
  const [students, setStudents] = useState<User[]>([]);
  const [showCreateSt, setShowCreateSt] = useState(false);
  const [newLogin, setNewLogin] = useState("");
  const [newPass, setNewPass] = useState("");
  const [newGroupId, setNewGroupId] = useState<number | "">("");

  /* ----------- —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è ----------- */
  const [exercises, setExercises] = useState<Exercise[]>([]);

  /* ----------- –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è ----------- */
  const [invite, setInvite] = useState<{ link: string; password: string } | null>(null);

  /* ----------- –æ–±—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ ----------- */
  const loadTeacher = useCallback(async () => {
    const [g, s, ex] = await Promise.all([
      api.get<Group[]>("/groups").then((r) => r.data),
      api.get<User[]>("/students").then((r) => r.data),
      getExercises().then((r) => r.data),
    ]);
    setGroups(g);
    setStudents(s);
    setExercises(ex);
  }, []);

  /* –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ */
  useEffect(() => {
    loadTeacher().catch(console.error);
  }, [loadTeacher]);

  /* ----------- –≥—Ä—É–ø–ø—ã: —Å–æ–∑–¥–∞–Ω–∏–µ ----------- */
  const createGroup = async () => {
    if (!groupName.trim()) return;
    await api.post("/groups", { name: groupName });
    setGroupName("");
    await loadTeacher();
  };

  /* ----------- —É—á–µ–Ω–∏–∫–∏: —Å–æ–∑–¥–∞–Ω–∏–µ ----------- */
  const createStudent = async () => {
    if (!newLogin.trim() || !newPass.trim()) return;
    await api.post("/students/create", {
      username: newLogin,
      password: newPass,
      group_id: newGroupId || undefined,
    });
    setNewLogin("");
    setNewPass("");
    setNewGroupId("");
    setShowCreateSt(false);
    await loadTeacher();
  };

  /* ----------- —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥–ª—è –∫–æ–ª–ª–µ–≥–∏ ----------- */
  const createTeacherInvite = async () => {
    const pwd = prompt("–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è:");
    if (!pwd) return;
    try {
      const { data } = await api.post<{ link: string; password: string }>("/invites/teacher-link", {
        password: pwd,
      });
      setInvite({ link: data.link, password: data.password });
    } catch (e: unknown) {
      const msg = (e as { response?: { data?: { detail?: string } } })?.response?.data?.detail;
      alert(msg || "–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è");
    }
  };

  /* ----------- –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ¬´InviteLinks¬ª –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π –∂–µ —Ñ–∞–π–ª—ã ----------- */
  const InviteLinks = () => {
    const [tCode, setTCode] = useState("");
    const [sCode, setSCode] = useState("");

    const loadCodes = useCallback(async () => {
      const [t, s] = await Promise.all([
        api.get<{ invite_code: string }>("/invites/teacher").then((r) => r.data.invite_code),
        api.get<{ invite_code: string }>("/invites/student").then((r) => r.data.invite_code),
      ]);
      setTCode(t);
      setSCode(s);
    }, []);

    useEffect(() => {
      loadCodes().catch(console.error);
    }, [loadCodes]);

    return (
      <div className={styles.inviteBlock}>
        <div style={{ marginBottom: "1rem" }}>
          –î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π: <span className={styles.code}>{tCode}</span>
        </div>

        <button className={styles.btn} onClick={createTeacherInvite}>
          –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥–ª—è –∫–æ–ª–ª–µ–≥–∏
        </button>

        {invite && (
          <div className={styles.inviteBlock} style={{ marginTop: "1rem" }}>
            <div>
              –°—Å—ã–ª–∫–∞: <b>{invite.link}</b>
            </div>
            <div>
              –ü–∞—Ä–æ–ª—å: <b>{invite.password}</b>
            </div>
          </div>
        )}

        <div style={{ marginTop: "1rem" }}>
          –î–ª—è —É—á–µ–Ω–∏–∫–æ–≤: <span className={styles.code}>{sCode}</span>
        </div>
      </div>
    );
  };

  /* ----------- —Ä–µ–Ω–¥–µ—Ä ----------- */
  return (
    <div className={styles.page}>
      <h2 className={styles.h2}>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</h2>

      {/*  –£–ü–†–ê–ñ–ù–ï–ù–ò–Ø  */}
      <h3 className={styles.h3}>–ú–æ–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h3>
      <ul className={styles.list}>
        {exercises.map((ex) => (
          <li key={ex.id}>
            {ex.name} (–ø–æ–ø–∞–¥–∞–Ω–∏–π: {ex.max_hits}, –≤—Ä–µ–º—è: {ex.time_sec || "‚àû"} —Å)
          </li>
        ))}
      </ul>
      <AddExercise onAdd={loadTeacher} />

      {/*  –£–ß–ï–ù–ò–ö–ò  */}
      <h3 className={styles.h3}>–£—á–µ–Ω–∏–∫–∏</h3>
      {!showCreateSt ? (
        <button className={styles.btn} onClick={() => setShowCreateSt(true)}>
          –°–æ–∑–¥–∞—Ç—å —É—á–µ–Ω–∏–∫–∞
        </button>
      ) : (
        <div className={styles.inline}>
          <input
            className={styles.input}
            placeholder="–õ–æ–≥–∏–Ω"
            value={newLogin}
            onChange={(e) => setNewLogin(e.target.value)}
          />
          <input
            className={styles.input}
            placeholder="–ü–∞—Ä–æ–ª—å"
            type="password"
            value={newPass}
            onChange={(e) => setNewPass(e.target.value)}
          />
          <select
            className={styles.input}
            value={newGroupId}
            onChange={(e) => setNewGroupId(Number(e.target.value) || "")}
          >
            <option value="">‚Äì –±–µ–∑ –≥—Ä—É–ø–ø—ã ‚Äì</option>
            {groups.map((g) => (
              <option key={g.id} value={g.id}>
                {g.name}
              </option>
            ))}
          </select>
          <button className={styles.btn} onClick={createStudent}>
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
          </button>
          <button className={styles.btn} onClick={() => setShowCreateSt(false)}>
            –û—Ç–º–µ–Ω–∞
          </button>
        </div>
      )}

      {/*  –ì–†–£–ü–ü–´  */}
      <h3 className={styles.h3}>–ú–æ–∏ –≥—Ä—É–ø–ø—ã</h3>
      <ul className={styles.list}>
        {groups.map((g) => (
          <li key={g.id}>{g.name}</li>
        ))}
      </ul>
      <input
        className={styles.input}
        placeholder="–Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã"
        value={groupName}
        onChange={(e) => setGroupName(e.target.value)}
      />
      <button className={styles.btn} onClick={createGroup}>
        –°–æ–∑–¥–∞—Ç—å
      </button>

      {/*  –°–ü–ò–°–û–ö –£–ß–ï–ù–ò–ö–û–í  */}
      <h3 className={styles.h3}>–°–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤</h3>
      <ul className={styles.list}>
        {students.map((s) => (
          <li key={s.id}>{s.username}</li>
        ))}
      </ul>

      <InviteLinks />
    </div>
  );
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/pages/TeacherDashboard.tsx ===

=== –§–∞–π–ª: ./frontend/src/types.ts ===
export interface User {
  id: number;
  username: string;
  is_teacher: boolean;
  created_at: string;
}

export interface Group {
  id: number;
  name: string;
  created_at: string;
}

export interface Shooting {
  exercise_id: number;
  student_id: number;
  id: number;
  exercise: Exercise;
  note: string;
  canvas_json: string;
  photo_url: string;
  created_at: string;
  student: User;
  group?: Group;
  time_spent: number;
  hits_count: number;
}

export interface Exercise {
  id: number;
  name: string;
  target_url: string;
  max_hits: number;
  time_sec: number;
  created_at: string;
}


=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/src/types.ts ===

=== –§–∞–π–ª: ./frontend/tsconfig.app.json ===
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}

=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/tsconfig.app.json ===

=== –§–∞–π–ª: ./frontend/tsconfig.json ===
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}

=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/tsconfig.json ===

=== –§–∞–π–ª: ./frontend/tsconfig.node.json ===
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}

=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/tsconfig.node.json ===

=== –§–∞–π–ª: ./frontend/vite.config.ts ===
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: { host: "0.0.0.0", port: 5173 }
})
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./frontend/vite.config.ts ===

=== –§–∞–π–ª: ./nginx/nginx.conf ===
# ./nginx/nginx.conf
events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    upstream backend {
        server backend:8000;
    }

    server {
        listen 80;
        server_name _;

        # –°—Ç–∞—Ç–∏–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
        location / {
            root /usr/share/nginx/html;
            try_files $uri $uri/ /index.html;
        }

        # API ‚Üí backend
        location /api {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Uploads ‚Üí backend static
        location /uploads {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Health-check
        location /health {
            proxy_pass http://backend;
        }
    }
}
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./nginx/nginx.conf ===

=== –§–∞–π–ª: ./to_text.sh ===
#!/bin/bash

# –§–∞–π–ª –¥–ª—è –≤—ã–≤–æ–¥–∞
OUTPUT_FILE="all_files_content.txt"

# –°–ø–∏—Å–æ–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (—á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª)
EXCLUDE_LIST="node_modules .next .git __pycache__ v1 infra backend  *.module.css Readme.md models *.log init tests package-lock.json venv all_files_content.txt venv pnpm-lock.yaml"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω—É–∂–Ω–æ –ª–∏ –∏—Å–∫–ª—é—á–∏—Ç—å —Ñ–∞–π–ª/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
should_exclude() {
    local item="$1"
    for pattern in $EXCLUDE_LIST; do
        if [[ "$item" == $pattern ]]; then
            return 0  # true - –∏—Å–∫–ª—é—á–∏—Ç—å
        fi
    done
    return 1  # false - –Ω–µ –∏—Å–∫–ª—é—á–∞—Ç—å
}

# –û—á–∏—â–∞–µ–º —Ñ–∞–π–ª –≤—ã–≤–æ–¥–∞
> "$OUTPUT_FILE"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
process_directory() {
    local dir="$1"
    
    for item in "$dir"/*; do
        # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–º—è —Ñ–∞–π–ª–∞/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        local base_name=$(basename "$item")
        
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—É—â—É—é –∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        if [[ "$base_name" == "." || "$base_name" == ".." ]]; then
            continue
        fi
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏—è
        if should_exclude "$base_name"; then
            echo "–ü—Ä–æ–ø—É—Å–∫–∞–µ–º: $item" >&2
            continue
        fi
        
        if [[ -d "$item" ]]; then
            # –≠—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è - —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
            echo "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é: $item" >&2
            process_directory "$item"
        elif [[ -f "$item" ]]; then
            # –≠—Ç–æ —Ñ–∞–π–ª - –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            echo "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª: $item" >&2
            echo "=== –§–∞–π–ª: $item ===" >> "$OUTPUT_FILE"
            
            # –ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –∫–∞–∫ —Ç–µ–∫—Å—Ç
            if file "$item" | grep -q "text"; then
                cat "$item" >> "$OUTPUT_FILE" 2>/dev/null
            else
                echo "[–ë–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è]" >> "$OUTPUT_FILE"
            fi
            
            echo -e "\n=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: $item ===\n" >> "$OUTPUT_FILE"
        fi
    done
}

# –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
echo "–ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ–∞–π–ª–æ–≤..."
process_directory "."

echo "–ì–æ—Ç–æ–≤–æ! –í—Å–µ —Ñ–∞–π–ª—ã –∑–∞–ø–∏—Å–∞–Ω—ã –≤: $OUTPUT_FILE"
=== –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞: ./to_text.sh ===

